<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energen Calculator Settings - Excel Actual Data</title>
    <!-- Error Handler - Must load first to prevent console auto-opening -->
    <script src="js/error-handler.js"></script>
    <style>
        :root {
            --bg-primary: #0a0b0d;
            --bg-secondary: #12141a;
            --bg-tertiary: #1a1d26;
            --bg-elevated: #22252f;
            --bg-card: #1e2028;
            --text-primary: #e4e6eb;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --accent-blue: #3b82f6;
            --accent-electric: #60a5fa;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-error: #ef4444;
            --border-subtle: #1f2937;
            --border-light: #374151;
            --gradient-blue: linear-gradient(135deg, #3b82f6, #60a5fa);
            --gradient-electric: linear-gradient(135deg, #60a5fa, #93c5fd);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.5);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.5);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.5);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'SF Pro Display', sans-serif;
            font-size: 13px;
            background: linear-gradient(135deg, var(--bg-primary) 0%, #0f1114 100%);
            color: var(--text-primary);
            height: 100vh;
            overflow: hidden;
        }

        .settings-container {
            display: flex;
            height: 100vh;
        }

        /* Tab Navigation */
        .tab-nav {
            width: 240px;
            background: linear-gradient(180deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-right: 1px solid var(--border-subtle);
            padding: 24px 0;
            overflow-y: auto;
            box-shadow: var(--shadow-md);
        }

        .tab-nav::-webkit-scrollbar {
            width: 6px;
        }

        .tab-nav::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        .tab-nav::-webkit-scrollbar-thumb {
            background: var(--accent-blue);
            border-radius: 3px;
        }

        .tab-item {
            padding: 14px 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
            position: relative;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: 0.3px;
        }

        .tab-item:hover {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1) 0%, transparent 100%);
            padding-left: 28px;
        }

        .tab-item.active {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.2) 0%, rgba(96, 165, 250, 0.05) 100%);
            border-left-color: var(--accent-electric);
            color: var(--accent-electric);
            font-weight: 600;
        }

        .tab-item.active::after {
            content: '';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            background: var(--accent-electric);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--accent-electric);
        }

        /* Content Area */
        .tab-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            background: var(--bg-primary);
            position: relative;
        }

        .tab-content::-webkit-scrollbar {
            width: 8px;
        }

        .tab-content::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: 4px;
        }

        .tab-content::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--accent-blue), var(--accent-electric));
            border-radius: 4px;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Form Styles */
        .section-title {
            color: var(--accent-electric);
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 24px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border-subtle);
            background: linear-gradient(90deg, var(--accent-electric), transparent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            position: relative;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 2px;
            background: var(--gradient-electric);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-md);
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            position: relative;
        }

        label {
            color: var(--text-secondary);
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        label span {
            font-size: 10px;
            opacity: 0.8;
        }

        input[type="number"],
        input[type="text"],
        select {
            background: linear-gradient(135deg, var(--bg-elevated), var(--bg-tertiary));
            border: 1px solid var(--border-light);
            color: var(--text-primary);
            padding: 10px 14px;
            border-radius: 8px;
            font-family: inherit;
            font-size: 13px;
            transition: all 0.3s ease;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3);
        }

        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: var(--accent-electric);
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2), inset 0 1px 3px rgba(0, 0, 0, 0.2);
            background: var(--bg-elevated);
        }

        input[readonly] {
            opacity: 0.7;
            cursor: not-allowed;
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-secondary)) !important;
        }

        select {
            cursor: pointer;
            background-image: linear-gradient(135deg, var(--bg-elevated), var(--bg-tertiary)),
                              url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%2360a5fa' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: auto, 1.5em 1.5em;
            padding-right: 2.5rem;
        }

        /* Range Slider Styles */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            outline: none;
            margin: 10px 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--gradient-electric);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(96, 165, 250, 0.4);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 3px 10px rgba(96, 165, 250, 0.6);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--gradient-electric);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(96, 165, 250, 0.4);
        }

        /* Service Tables */
        .service-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 32px;
            background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-subtle);
        }

        .service-table th {
            background: linear-gradient(90deg, var(--bg-tertiary), var(--bg-elevated));
            padding: 14px;
            text-align: left;
            font-weight: 700;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-electric);
            border-bottom: 2px solid var(--accent-blue);
            position: relative;
        }

        .service-table th:first-child {
            border-top-left-radius: 12px;
        }

        .service-table th:last-child {
            border-top-right-radius: 12px;
        }

        .service-table td {
            padding: 10px 14px;
            border-bottom: 1px solid rgba(31, 41, 55, 0.5);
            transition: background 0.2s ease;
        }

        .service-table tr:hover td {
            background: rgba(59, 130, 246, 0.05);
        }

        .service-table tr:last-child td {
            border-bottom: none;
        }

        .service-table input {
            width: 100%;
            padding: 6px 10px;
            background: linear-gradient(135deg, var(--bg-elevated), var(--bg-tertiary));
            border: 1px solid var(--border-light);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 12px;
            transition: all 0.2s ease;
        }

        .service-table input:focus {
            outline: none;
            border-color: var(--accent-electric);
            box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
            background: var(--bg-elevated);
        }

        .total-hours,
        .total-labor,
        .total-analysis-cost {
            font-weight: 600;
            color: var(--accent-electric);
            font-size: 13px;
        }

        .total-row {
            background: linear-gradient(90deg, rgba(59, 130, 246, 0.1), transparent);
            font-weight: 700;
        }

        /* Action Buttons */
        .action-bar {
            position: fixed;
            bottom: 0;
            right: 0;
            left: 240px;
            background: linear-gradient(180deg, var(--bg-secondary), var(--bg-tertiary));
            border-top: 2px solid var(--border-subtle);
            padding: 20px 40px;
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .btn {
            padding: 10px 24px;
            border: 1px solid var(--border-light);
            background: linear-gradient(135deg, var(--bg-elevated), var(--bg-tertiary));
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 12px;
            font-weight: 600;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.4s ease, height 0.4s ease;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn-primary {
            background: var(--gradient-blue);
            border: none;
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            background: var(--gradient-electric);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(96, 165, 250, 0.4);
        }

        .btn:hover {
            background: linear-gradient(135deg, var(--bg-tertiary), var(--bg-elevated));
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Info boxes */
        .info-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(96, 165, 250, 0.05));
            border: 1px solid var(--accent-blue);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 24px;
            color: var(--accent-electric);
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(59, 130, 246, 0.1);
        }

        .info-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-electric);
        }

        .info-box strong {
            color: var(--accent-electric);
            font-weight: 700;
        }

        .kw-range-label {
            color: var(--accent-electric);
            font-weight: 700;
            min-width: 110px;
            font-size: 12px;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            background: linear-gradient(90deg, rgba(96, 165, 250, 0.1), transparent);
            border-radius: 4px;
        }

        .btn:active {
            transform: translateY(0);
        }

        /* Additional UI Enhancements */
        .tab-panel {
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Force dark theme on ALL inputs and elements */
        input, textarea, select {
            background: var(--bg-elevated) !important;
            color: var(--text-primary) !important;
            border: 1px solid var(--border-light) !important;
        }
        
        /* Special handling for checkboxes and radio buttons */
        input[type="checkbox"],
        input[type="radio"] {
            accent-color: var(--accent-electric) !important;
            cursor: pointer;
        }
        
        /* Labels should always be visible */
        label {
            color: var(--text-secondary) !important;
        }
        
        /* Ensure table cells are themed */
        td, th {
            color: var(--text-primary) !important;
            background: transparent !important;
        }
        
        /* Ensure all text elements are properly styled */
        p, span, div, h1, h2, h3, h4, h5, h6 {
            color: var(--text-primary);
        }
        
        /* Fix any elements that might inherit wrong colors */
        * {
            color: inherit;
        }
        
        /* Specific fix for any form labels or descriptions */
        .form-label, .form-description, .helper-text {
            color: var(--text-secondary) !important;
        }
        
        /* Fix any browser default styles */
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus,
        input:-webkit-autofill:active {
            -webkit-box-shadow: 0 0 0 30px var(--bg-elevated) inset !important;
            -webkit-text-fill-color: var(--text-primary) !important;
            caret-color: var(--text-primary) !important;
        }
        
        /* Enhanced Settings Grid */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
            box-shadow: var(--shadow-md);
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-left: 8px;
        }

        .status-active {
            background: var(--accent-success);
            box-shadow: 0 0 8px var(--accent-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="settings-container">
        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <div class="tab-item active" data-tab="labor">Labor & Travel</div>
            <div class="tab-item" data-tab="materials">Materials & Markups</div>
            <div class="tab-item" data-tab="service-a">Service A - Inspection</div>
            <div class="tab-item" data-tab="service-b">Service B - Oil & Filter</div>
            <div class="tab-item" data-tab="service-c">Service C - Coolant</div>
            <div class="tab-item" data-tab="service-d">Service D - Oil, Fuel & Coolant Analysis</div>
            <div class="tab-item" data-tab="battery">Battery Service</div>
            <div class="tab-item" data-tab="fuel-polish">Fuel Polishing</div>
            <div class="tab-item" data-tab="service-e">Service E - Load Bank</div>
            <div class="tab-item" data-tab="service-f">Service F - Diesel Tune-Up</div>
            <div class="tab-item" data-tab="service-g">Service G - Gas Tune-Up</div>
            <div class="tab-item" data-tab="service-h">Service H - Electrical Test</div>
            <div class="tab-item" data-tab="service-i">Service I - Transfer Switch</div>
            <div class="tab-item" data-tab="service-j">Service J - Thermal Imaging</div>
            <div class="tab-item" data-tab="frequency">Frequency Matrix</div>
            <div class="tab-item" data-tab="tax-fees">Tax & Fees</div>
            <div class="tab-item" data-tab="company">Company Info</div>
        </nav>

        <!-- Content Area -->
        <div class="tab-content">
            <!-- Labor & Travel Tab -->
            <div class="tab-panel active" id="labor">
                <h2 class="section-title">Labor & Travel Configuration</h2>
                
                <!-- Active Rate Configuration -->
                <div style="background: linear-gradient(135deg, #1f2937, #111827); padding: 20px; border-radius: 12px; margin-bottom: 25px; border: 2px solid #3b82f6;">
                    <h3 style="color: var(--accent-gold); margin-bottom: 15px; display: flex; align-items: center;">
                        <span style="margin-right: 10px;">‚öôÔ∏è</span> Active Rate Configuration
                    </h3>
                    <div class="form-group">
                        <label style="display: block; margin-bottom: 10px; font-weight: 600;">Select Pricing Mode</label>
                        <select id="rateMode" onchange="updateRateMode()" style="width: 100%; padding: 12px; background: #12141a; border: 2px solid #3b82f6; border-radius: 8px; color: white; font-size: 16px;">
                            <option value="private" selected>Private Sector (Standard Rates)</option>
                            <option value="public-works">Public Works (Prevailing Wage)</option>
                            <option value="government">Government Contract (GSA Schedule)</option>
                        </select>
                        <div id="rateModeDescription" style="margin-top: 15px; padding: 15px; background: rgba(59, 130, 246, 0.1); border-radius: 8px; border-left: 4px solid #3b82f6;">
                            <strong style="color: var(--accent-electric);">Private Sector Mode</strong><br>
                            Using Energen standard labor rates for commercial customers.<br>
                            ‚Ä¢ Base Rate: $180.00/hr<br>
                            ‚Ä¢ No prevailing wage requirements<br>
                            ‚Ä¢ Standard markups apply
                        </div>
                    </div>
                </div>

                <!-- Standard Labor Rates Section -->
                <div id="standardRatesSection">
                    <h3 style="color: var(--accent-electric); margin-bottom: 20px; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">
                        Standard Labor Rates (Private Sector)
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label style="font-weight: 600;">Base Labor Rate ($/hr)</label>
                            <input type="number" id="laborRate" value="180.00" step="0.01" min="0" onchange="updateOvertimeRates()" 
                                   style="background: #1a1a2e; border: 2px solid #4a5568; color: white; font-size: 18px; font-weight: bold;">
                            <small style="color: #9ca3af;">Energen standard rate</small>
                        </div>
                        <div class="form-group">
                            <label>Overtime Rate ($/hr)</label>
                            <input type="number" id="overtimeRate" value="270.00" step="0.01" readonly 
                                   style="background: #2d3748; border: 1px solid #4a5568; color: #63b3ed;">
                            <small style="color: #9ca3af;">Auto-calculated: 1.5 √ó base</small>
                        </div>
                        <div class="form-group">
                            <label>Double Time Rate ($/hr)</label>
                            <input type="number" id="doubleTimeRate" value="360.00" step="0.01" readonly 
                                   style="background: #2d3748; border: 1px solid #4a5568; color: #63b3ed;">
                            <small style="color: #9ca3af;">Auto-calculated: 2.0 √ó base</small>
                        </div>
                        <div class="form-group">
                            <label>Travel Time Rate ($/hr)</label>
                            <input type="number" id="travelRate" value="100.00" step="0.01" min="0">
                            <small style="color: #9ca3af;">Portal-to-portal travel</small>
                        </div>
                        <div class="form-group">
                            <label>Mobilization Rate ($/hr)</label>
                            <input type="number" id="mobilizationRate" value="180.00" step="0.01" min="0">
                            <small style="color: #9ca3af;">Defaults to labor rate</small>
                        </div>
                        <div class="form-group">
                            <label>Mileage Rate ($/mile)</label>
                            <input type="number" id="mileageRate" value="2.50" step="0.01" min="0">
                            <small style="color: #9ca3af;">Vehicle expenses</small>
                        </div>
                    </div>

                    <!-- Shop Location & Distance -->
                    <h3 style="color: var(--accent-electric); margin: 30px 0 20px; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">
                        Shop Location & Distance
                    </h3>
                    <div class="form-grid">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label>Shop Address</label>
                            <input type="text" id="shopAddress" value="150 Mason Circle, Suite K, Concord, CA 94520" style="width: 100%;">
                            <small style="color: #9ca3af;">Base location for distance calculations</small>
                        </div>
                        <div class="form-group">
                            <label>Distance from Shop (miles)</label>
                            <input type="number" id="distanceFromShop" value="0" step="0.1" min="0" onchange="recalculateTotals()">
                            <small style="color: #9ca3af;">Auto-calculated from address or manually entered</small>
                        </div>
                        <div class="form-group">
                            <label>Current Tax Rate (%)</label>
                            <input type="number" id="currentTaxRate" value="8.4" step="0.01" min="0" max="15" onchange="recalculateTotals()">
                            <small style="color: #9ca3af;">Auto-calculated from address or manually entered</small>
                        </div>
                    </div>
                </div>

                <!-- Prevailing Wage Settings Section -->
                <div id="prevailingWageSection" style="display: none;">
                    <h3 style="color: var(--accent-gold); margin: 30px 0 20px; border-bottom: 2px solid #f59e0b; padding-bottom: 10px;">
                        Prevailing Wage Settings (Public Works)
                    </h3>

                    <!-- Prevailing Wage API Data (Read-Only) -->
                    <div style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #10b981;">
                        <h4 style="color: var(--accent-success); margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 18px;">‚úì</span>
                            DIR Prevailing Wage Rate (Auto-Detected)
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>ZIP Code</label>
                                <input type="text" id="pwZipCode" readonly style="background: #0a0b0d; opacity: 0.7; cursor: not-allowed;">
                            </div>
                            <div class="form-group">
                                <label>County</label>
                                <input type="text" id="pwCounty" readonly style="background: #0a0b0d; opacity: 0.7; cursor: not-allowed;">
                            </div>
                            <div class="form-group">
                                <label>Classification</label>
                                <input type="text" id="pwClassification" readonly value="Electrician Inside Wireman" style="background: #0a0b0d; opacity: 0.7; cursor: not-allowed;">
                            </div>
                            <div class="form-group">
                                <label>Prevailing Wage Rate ($/hr)</label>
                                <input type="number" id="pwApiRate" readonly value="0.00" style="background: #0a0b0d; opacity: 0.7; font-weight: bold; color: #10b981; cursor: not-allowed;">
                            </div>
                            <div class="form-group" style="grid-column: 1 / -1;">
                                <button onclick="refreshPrevailingWage()" style="padding: 8px 16px; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
                                    üîÑ Refresh from DIR API
                                </button>
                                <small style="color: #9ca3af; margin-left: 10px;">Last updated: <span id="pwLastUpdated">--</span></small>
                            </div>
                        </div>
                    </div>

                    <!-- Operating Engineers Classification -->
                    <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #f59e0b;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 10px;">Operating Engineers Classification</h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Classification</label>
                                <select id="oeClassification" onchange="updateOERate()" style="background: #1a1a2e; border: 2px solid #f59e0b;">
                                    <option value="group8" selected>Group 8 - Stationary Power Plant</option>
                                    <option value="group3">Group 3 - Mobile Equipment</option>
                                    <option value="group1">Group 1 - Basic Equipment</option>
                                    <option value="foreman">Foreman Rate</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Zone Adjustment</label>
                                <select id="zoneMultiplier" onchange="updateOERate()" style="background: #1a1a2e; border: 2px solid #f59e0b;">
                                    <option value="1.15">Zone 1 - Bay Area (+15%)</option>
                                    <option value="1.10">Zone 2 - LA/SD (+10%)</option>
                                    <option value="1.00" selected>Zone 3 - Central Valley (Base)</option>
                                    <option value="0.90">Zone 4 - Rural (-10%)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label style="font-weight: 600;">OE Group 8 Base ($/hr)</label>
                            <input type="number" id="oeGroup8Rate" value="92.00" step="0.01" readonly 
                                   style="background: #2d3748; border: 2px solid #f59e0b; color: #fbbf24; font-size: 18px; font-weight: bold;">
                            <small style="color: #9ca3af;">Stationary Engineers rate</small>
                        </div>
                        <div class="form-group">
                            <label>Adjusted Base ($/hr)</label>
                            <input type="number" id="oeAdjustedRate" value="92.00" step="0.01" readonly 
                                   style="background: #2d3748; border: 1px solid #f59e0b; color: #fbbf24;">
                            <small style="color: #9ca3af;">With zone multiplier</small>
                        </div>
                        <div class="form-group">
                            <label>Total with Fringe ($/hr)</label>
                            <input type="number" id="oeTotalRate" value="124.00" step="0.01" readonly 
                                   style="background: #2d3748; border: 2px solid #10b981; color: #10b981; font-size: 18px; font-weight: bold;">
                            <small style="color: #9ca3af;">Effective hourly rate</small>
                        </div>
                        <div class="form-group">
                            <label>Overtime ($/hr)</label>
                            <input type="number" id="oeOvertimeRate" value="186.00" step="0.01" readonly 
                                   style="background: #2d3748; border: 1px solid #4a5568; color: #63b3ed;">
                            <small style="color: #9ca3af;">1.5 √ó adjusted base</small>
                        </div>
                        <div class="form-group">
                            <label>Double Time ($/hr)</label>
                            <input type="number" id="oeDoubleTimeRate" value="248.00" step="0.01" readonly 
                                   style="background: #2d3748; border: 1px solid #4a5568; color: #63b3ed;">
                            <small style="color: #9ca3af;">2.0 √ó adjusted base</small>
                        </div>
                    </div>

                    <!-- Business Overhead Costs -->
                    <div style="background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #3b82f6;">
                        <h4 style="color: var(--accent-electric); margin-bottom: 10px;">
                            Business Overhead & Costs
                        </h4>
                        <div class="form-group">
                            <label>Business Overhead ($/hr)</label>
                            <input type="number" id="businessOverhead" value="115.00" step="1" min="0" onchange="calculatePrevailingWageTotal()" style="background: #1a1a2e; border: 2px solid #3b82f6;">
                            <small style="color: #9ca3af;">Fixed costs: insurance, workers comp, overhead, profit</small>
                        </div>
                    </div>

                    <!-- Total Labor Rate Calculation -->
                    <div style="background: rgba(245, 158, 11, 0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #f59e0b;">
                        <h4 style="color: var(--accent-warning); margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <span style="font-size: 18px;">‚ö°</span>
                            Total Labor Billing Rate
                        </h4>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Calculated Rate ($/hr)</label>
                                <input type="number" id="pwCalculatedRate" readonly value="0.00" style="background: #0a0b0d; opacity: 0.7; font-weight: bold; cursor: not-allowed;">
                                <small style="color: #9ca3af;" id="pwCalculatedBreakdown">= $0.00 (wage) + $0.00 (overhead)</small>
                            </div>
                            <div class="form-group">
                                <label>Final Billing Rate ($/hr) - Editable</label>
                                <input type="number" id="pwFinalRate" value="0.00" step="0.50" min="0" onchange="handleFinalRateOverride()" style="font-weight: bold; color: #f59e0b; background: #1a1a2e; border: 2px solid #f59e0b;">
                                <small style="color: #9ca3af;">Override if needed (e.g., $215.00)</small>
                            </div>
                        </div>
                    </div>

                    <!-- Fringe Benefits Breakdown -->
                    <h4 style="color: var(--accent-electric); margin: 25px 0 15px;">Fringe Benefits Breakdown</h4>
                    <div class="form-grid" style="background: rgba(59, 130, 246, 0.05); padding: 15px; border-radius: 8px;">
                        <div class="form-group">
                            <label>Health & Welfare ($/hr)</label>
                            <input type="number" id="fringeHealth" value="12.50" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label>Pension ($/hr)</label>
                            <input type="number" id="fringePension" value="15.00" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label>Vacation/Holiday ($/hr)</label>
                            <input type="number" id="fringeVacation" value="3.50" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label>Training ($/hr)</label>
                            <input type="number" id="fringeTraining" value="1.00" step="0.01" readonly>
                        </div>
                        <div class="form-group">
                            <label style="font-weight: 600;">Total Fringe ($/hr)</label>
                            <input type="number" id="fringeTotal" value="32.00" step="0.01" readonly 
                                   style="background: #1a1a2e; border: 2px solid #10b981; color: #10b981; font-weight: bold;">
                        </div>
                    </div>
                </div>

                <!-- Per Diem Rates Section -->
                <div id="perDiemSection" style="margin-top: 30px;">
                    <h3 style="color: var(--accent-electric); margin-bottom: 20px; border-bottom: 2px solid #3b82f6; padding-bottom: 10px;">
                        Per Diem Rates (GSA 2024)
                    </h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Location</label>
                            <select id="perDiemLocation" onchange="updatePerDiemRates()" style="background: #1a1a2e; border: 2px solid #3b82f6;">
                                <option value="sf" selected>San Francisco ($383/day)</option>
                                <option value="la">Los Angeles ($269/day)</option>
                                <option value="sd">San Diego ($255/day)</option>
                                <option value="sac">Sacramento ($198/day)</option>
                                <option value="standard">Standard Rate ($166/day)</option>
                                <option value="custom">Custom Entry</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Lodging ($/day)</label>
                            <input type="number" id="perDiemLodging" value="304" step="1" 
                                   style="background: #2d3748; border: 1px solid #4a5568;">
                        </div>
                        <div class="form-group">
                            <label>Meals & Incidentals ($/day)</label>
                            <input type="number" id="perDiemMeals" value="79" step="1" 
                                   style="background: #2d3748; border: 1px solid #4a5568;">
                        </div>
                        <div class="form-group">
                            <label style="font-weight: 600;">Total Per Diem ($/day)</label>
                            <input type="number" id="perDiemTotal" value="383" step="1" readonly 
                                   style="background: #1a1a2e; border: 2px solid #10b981; color: #10b981; font-weight: bold;">
                        </div>
                        <div class="form-group">
                            <label>IRS Mileage ($/mile)</label>
                            <input type="number" id="irsMileageRate" value="0.67" step="0.01" 
                                   style="background: #2d3748; border: 1px solid #4a5568;">
                            <small style="color: #9ca3af;">2024 IRS standard rate</small>
                        </div>
                    </div>
                </div>

                <!-- Summary Display -->
                <div style="background: linear-gradient(135deg, #065f46, #064e3b); padding: 20px; border-radius: 12px; margin-top: 30px; border: 2px solid #10b981;">
                    <h3 style="color: #10b981; margin-bottom: 15px;">Effective Rate Summary</h3>
                    <div id="rateSummary" style="color: white; font-size: 14px; line-height: 1.8;">
                        <strong>Mode:</strong> Private Sector<br>
                        <strong>Base Rate:</strong> $180.00/hr<br>
                        <strong>Overtime:</strong> $270.00/hr (1.5√ó)<br>
                        <strong>Double Time:</strong> $360.00/hr (2.0√ó)<br>
                        <strong>Per Diem:</strong> Not applicable
                    </div>
                </div>
            </div>

            <!-- Materials Tab -->
            <div class="tab-panel" id="materials">
                <h2 class="section-title">Materials & Markups (Excel Actual)</h2>
                <div class="info-box">
                    Values from Excel 'Ser Menu 2022 Rates' sheet - Cost Factors section
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Oil Cost ($/gallon) <span style="color: var(--accent-electric);">[Excel: C10]</span></label>
                        <input type="number" id="oilCost" value="16.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Oil Markup</label>
                        <input type="number" id="oilMarkup" value="1.5" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Coolant Cost ($/gallon) <span style="color: var(--accent-electric);">[Excel: C11]</span></label>
                        <input type="number" id="coolantCost" value="15.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Coolant Markup</label>
                        <input type="number" id="coolantMarkup" value="1.5" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Parts Markup (25%) <span style="color: var(--accent-electric);">[Excel: 1.25]</span></label>
                        <input type="number" id="partsMarkup" value="1.25" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Freight Rate (5%) <span style="color: var(--accent-electric);">[Excel: 0.05]</span></label>
                        <input type="number" id="freightRate" value="0.05" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Annual CPI Rate <span style="color: var(--accent-electric);">[Auto-detected from customer ZIP]</span></label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="annualEscalation" value="2.5" step="0.1" style="flex: 1;">
                            <span>%</span>
                        </div>
                        <small style="color: var(--accent-gold); display: block; margin-top: 5px;">
                            CPI is automatically fetched based on customer's ZIP code during calculation.
                            This default value is used only when ZIP is not available.
                        </small>
                    </div>
                    <div class="form-group">
                        <label>Fuel Analysis Cost ($) <span style="color: var(--accent-electric);">[Excel: E10]</span></label>
                        <input type="number" id="fuelAnalysisCost" value="60.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Oil Analysis Cost ($) <span style="color: var(--accent-electric);">[Excel: E11]</span></label>
                        <input type="number" id="oilAnalysisCost" value="16.55" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Air Filter Cost ($) <span style="color: var(--accent-electric);">[Excel: Fixed]</span></label>
                        <input type="number" id="airFilterCost" value="100.00" step="1.00">
                    </div>
                    <div class="form-group">
                        <label>Number of Inspections (Annual) <span style="color: var(--accent-electric);">[Excel: 4]</span></label>
                        <input type="number" id="numberOfInspections" value="4" step="1" min="1" max="12">
                    </div>
                    <div class="form-group">
                        <label>Transformer Rental ($) <span style="color: var(--accent-electric);">[505kW+]</span></label>
                        <input type="number" id="transformerRental" value="1500.00" step="100.00">
                    </div>
                    <div class="form-group">
                        <label>Delivery Cost ($) <span style="color: var(--accent-electric);">[505kW+]</span></label>
                        <input type="number" id="deliveryCost" value="3500.00" step="100.00">
                    </div>
                </div>
            </div>

            <!-- Service A - Comprehensive Inspection -->
            <div class="tab-panel" id="service-a">
                <h2 class="section-title">Service A - Comprehensive Inspection (Quarterly)</h2>
                <div class="info-box">
                    Excel Data: Labor varies 1-4 hours by kW range, Shop/Travel is 2 hours for all
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Range</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Total Hours</th>
                            <th>Total Labor ($)</th>
                            <th>Parts ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">2-14</td>
                            <td><input type="number" class="labor-hours" value="1" step="0.5" data-row="a-2-14"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-2-14"></td>
                            <td class="total-hours" data-row="a-2-14">3.0</td>
                            <td class="total-labor" data-row="a-2-14">$573.00</td>
                            <td><input type="number" value="601.65" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">15-30</td>
                            <td><input type="number" class="labor-hours" value="1" step="0.5" data-row="a-15-30"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-15-30"></td>
                            <td class="total-hours" data-row="a-15-30">3.0</td>
                            <td class="total-labor" data-row="a-15-30">$573.00</td>
                            <td><input type="number" value="601.65" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">35-150</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="a-35-150"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-35-150"></td>
                            <td class="total-hours" data-row="a-35-150">4.0</td>
                            <td class="total-labor" data-row="a-35-150">$764.00</td>
                            <td><input type="number" value="802.20" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">155-250</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="a-155-250"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-155-250"></td>
                            <td class="total-hours" data-row="a-155-250">4.0</td>
                            <td class="total-labor" data-row="a-155-250">$764.00</td>
                            <td><input type="number" value="802.20" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">255-400</td>
                            <td><input type="number" class="labor-hours" value="2.5" step="0.5" data-row="a-255-400"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-255-400"></td>
                            <td class="total-hours" data-row="a-255-400">4.5</td>
                            <td class="total-labor" data-row="a-255-400">$859.50</td>
                            <td><input type="number" value="902.48" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">405-500</td>
                            <td><input type="number" class="labor-hours" value="2.5" step="0.5" data-row="a-405-500"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-405-500"></td>
                            <td class="total-hours" data-row="a-405-500">4.5</td>
                            <td class="total-labor" data-row="a-405-500">$859.50</td>
                            <td><input type="number" value="902.48" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">505-670</td>
                            <td><input type="number" class="labor-hours" value="3" step="0.5" data-row="a-505-670"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-505-670"></td>
                            <td class="total-hours" data-row="a-505-670">5.0</td>
                            <td class="total-labor" data-row="a-505-670">$955.00</td>
                            <td><input type="number" value="1002.75" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">675-1050</td>
                            <td><input type="number" class="labor-hours" value="3" step="0.5" data-row="a-675-1050"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-675-1050"></td>
                            <td class="total-hours" data-row="a-675-1050">5.0</td>
                            <td class="total-labor" data-row="a-675-1050">$955.00</td>
                            <td><input type="number" value="1002.75" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1055-1500</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="a-1055-1500"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-1055-1500"></td>
                            <td class="total-hours" data-row="a-1055-1500">6.0</td>
                            <td class="total-labor" data-row="a-1055-1500">$1,146.00</td>
                            <td><input type="number" value="1203.30" step="0.01"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1500-2050</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="a-1500-2050"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="a-1500-2050"></td>
                            <td class="total-hours" data-row="a-1500-2050">6.0</td>
                            <td class="total-labor" data-row="a-1500-2050">$1,146.00</td>
                            <td><input type="number" value="1203.30" step="0.01"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service B - Oil & Filter -->
            <div class="tab-panel" id="service-b">
                <h2 class="section-title">Service B - Oil & Filter Service (Annual)</h2>
                <div class="info-box">
                    Excel Data from 'Ser Menu 2022 Rates' sheet - Complete with oil, batteries, and labor
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Range</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Total Hours</th>
                            <th>Total Labor</th>
                            <th>Filter Cost</th>
                            <th>Oil (Gallons)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">2-14</td>
                            <td><input type="number" class="labor-hours" value="1" step="0.5" data-row="b-2-14" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="b-2-14" data-service="b"></td>
                            <td class="total-hours" data-row="b-2-14">3.0</td>
                            <td class="total-labor" data-row="b-2-14">$573.00</td>
                            <td><input type="number" value="171.90" step="0.01"></td>
                            <td><input type="number" value="1.5" step="0.5"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">15-30</td>
                            <td><input type="number" class="labor-hours" value="1" step="0.5" data-row="b-15-30" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="b-15-30" data-service="b"></td>
                            <td class="total-hours" data-row="b-15-30">3.0</td>
                            <td class="total-labor" data-row="b-15-30">$573.00</td>
                            <td><input type="number" value="171.90" step="0.01"></td>
                            <td><input type="number" value="3" step="0.5"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">35-150</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="b-35-150" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="b-35-150" data-service="b"></td>
                            <td class="total-hours" data-row="b-35-150">4.0</td>
                            <td class="total-labor" data-row="b-35-150">$764.00</td>
                            <td><input type="number" value="229.20" step="0.01"></td>
                            <td><input type="number" value="5" step="0.5"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">155-250</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="b-155-250" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="b-155-250" data-service="b"></td>
                            <td class="total-hours" data-row="b-155-250">4.0</td>
                            <td class="total-labor" data-row="b-155-250">$764.00</td>
                            <td><input type="number" value="229.20" step="0.01"></td>
                            <td><input type="number" value="8" step="0.5"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">255-400</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="b-255-400" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="b-255-400" data-service="b"></td>
                            <td class="total-hours" data-row="b-255-400">6.0</td>
                            <td class="total-labor" data-row="b-255-400">$1,146.00</td>
                            <td><input type="number" value="343.80" step="0.01"></td>
                            <td><input type="number" value="12" step="0.5"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">405-500</td>
                            <td><input type="number" class="labor-hours" value="6" step="0.5" data-row="b-405-500" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="b-405-500" data-service="b"></td>
                            <td class="total-hours" data-row="b-405-500">8.0</td>
                            <td class="total-labor" data-row="b-405-500">$1,528.00</td>
                            <td><input type="number" value="458.40" step="0.01"></td>
                            <td><input type="number" value="18" step="0.5"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">505-670</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="b-505-670" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="4" step="0.5" data-row="b-505-670" data-service="b"></td>
                            <td class="total-hours" data-row="b-505-670">12.0</td>
                            <td class="total-labor" data-row="b-505-670">$2,292.00</td>
                            <td><input type="number" value="687.60" step="0.01"></td>
                            <td><input type="number" value="30" step="1"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">675-1050</td>
                            <td><input type="number" class="labor-hours" value="12" step="0.5" data-row="b-675-1050" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="4" step="0.5" data-row="b-675-1050" data-service="b"></td>
                            <td class="total-hours" data-row="b-675-1050">16.0</td>
                            <td class="total-labor" data-row="b-675-1050">$3,056.00</td>
                            <td><input type="number" value="916.80" step="0.01"></td>
                            <td><input type="number" value="50" step="1"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1055-1500</td>
                            <td><input type="number" class="labor-hours" value="16" step="0.5" data-row="b-1055-1500" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="4" step="0.5" data-row="b-1055-1500" data-service="b"></td>
                            <td class="total-hours" data-row="b-1055-1500">20.0</td>
                            <td class="total-labor" data-row="b-1055-1500">$3,820.00</td>
                            <td><input type="number" value="1146.00" step="0.01"></td>
                            <td><input type="number" value="100" step="1"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1500-2050</td>
                            <td><input type="number" class="labor-hours" value="16" step="0.5" data-row="b-1500-2050" data-service="b"></td>
                            <td><input type="number" class="mobilization-hours" value="4" step="0.5" data-row="b-1500-2050" data-service="b"></td>
                            <td class="total-hours" data-row="b-1500-2050">20.0</td>
                            <td class="total-labor" data-row="b-1500-2050">$3,820.00</td>
                            <td><input type="number" value="1146.00" step="0.01"></td>
                            <td><input type="number" value="150" step="1"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service C - Coolant Service -->
            <div class="tab-panel" id="service-c">
                <h2 class="section-title">Service C - Coolant Service (Annual/Biannual)</h2>
                <div class="info-box">
                    Excel Data from 'Ser Menu 2022 Rates' sheet - Exact values with calculated labor and coolant totals
                    <br><strong style="color: var(--accent-electric);">Formula:</strong> Coolant Gallons = Service B Oil Gallons √ó 1.5
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Range</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Total Hours</th>
                            <th>Total Labor</th>
                            <th>Coolant (Gallons)</th>
                            <th>Coolant Total</th>
                            <th>Hoses & Belts</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">2-14</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="c-2-14" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-2-14" data-service="c"></td>
                            <td class="total-hours" data-row="c-2-14">4.0</td>
                            <td class="total-labor" data-row="c-2-14">$764.00</td>
                            <td><input type="number" class="coolant-gallons" value="2.25" step="0.25" data-row="c-2-14"></td>
                            <td class="coolant-total" data-row="c-2-14">$50.63</td>
                            <td><input type="number" value="150" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">15-30</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="c-15-30" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-15-30" data-service="c"></td>
                            <td class="total-hours" data-row="c-15-30">4.0</td>
                            <td class="total-labor" data-row="c-15-30">$764.00</td>
                            <td><input type="number" class="coolant-gallons" value="4.5" step="0.25" data-row="c-15-30"></td>
                            <td class="coolant-total" data-row="c-15-30">$101.25</td>
                            <td><input type="number" value="200" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">35-150</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="c-35-150" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-35-150" data-service="c"></td>
                            <td class="total-hours" data-row="c-35-150">4.0</td>
                            <td class="total-labor" data-row="c-35-150">$764.00</td>
                            <td><input type="number" class="coolant-gallons" value="7.5" step="0.25" data-row="c-35-150"></td>
                            <td class="coolant-total" data-row="c-35-150">$168.75</td>
                            <td><input type="number" value="250" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">155-250</td>
                            <td><input type="number" class="labor-hours" value="3" step="0.5" data-row="c-155-250" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-155-250" data-service="c"></td>
                            <td class="total-hours" data-row="c-155-250">5.0</td>
                            <td class="total-labor" data-row="c-155-250">$955.00</td>
                            <td><input type="number" class="coolant-gallons" value="12" step="0.5" data-row="c-155-250"></td>
                            <td class="coolant-total" data-row="c-155-250">$270.00</td>
                            <td><input type="number" value="300" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">255-400</td>
                            <td><input type="number" class="labor-hours" value="3" step="0.5" data-row="c-255-400" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-255-400" data-service="c"></td>
                            <td class="total-hours" data-row="c-255-400">5.0</td>
                            <td class="total-labor" data-row="c-255-400">$955.00</td>
                            <td><input type="number" class="coolant-gallons" value="18" step="0.5" data-row="c-255-400"></td>
                            <td class="coolant-total" data-row="c-255-400">$405.00</td>
                            <td><input type="number" value="450" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">405-500</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="c-405-500" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-405-500" data-service="c"></td>
                            <td class="total-hours" data-row="c-405-500">6.0</td>
                            <td class="total-labor" data-row="c-405-500">$1,146.00</td>
                            <td><input type="number" class="coolant-gallons" value="27" step="1" data-row="c-405-500"></td>
                            <td class="coolant-total" data-row="c-405-500">$607.50</td>
                            <td><input type="number" value="500" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">505-670</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="c-505-670" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-505-670" data-service="c"></td>
                            <td class="total-hours" data-row="c-505-670">6.0</td>
                            <td class="total-labor" data-row="c-505-670">$1,146.00</td>
                            <td><input type="number" class="coolant-gallons" value="45" step="1" data-row="c-505-670"></td>
                            <td class="coolant-total" data-row="c-505-670">$1,012.50</td>
                            <td><input type="number" value="600" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">675-1050</td>
                            <td><input type="number" class="labor-hours" value="6" step="0.5" data-row="c-675-1050" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-675-1050" data-service="c"></td>
                            <td class="total-hours" data-row="c-675-1050">8.0</td>
                            <td class="total-labor" data-row="c-675-1050">$1,528.00</td>
                            <td><input type="number" class="coolant-gallons" value="75" step="1" data-row="c-675-1050"></td>
                            <td class="coolant-total" data-row="c-675-1050">$1,687.50</td>
                            <td><input type="number" value="650" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1055-1500</td>
                            <td><input type="number" class="labor-hours" value="6" step="0.5" data-row="c-1055-1500" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-1055-1500" data-service="c"></td>
                            <td class="total-hours" data-row="c-1055-1500">8.0</td>
                            <td class="total-labor" data-row="c-1055-1500">$1,528.00</td>
                            <td><input type="number" class="coolant-gallons" value="150" step="5" data-row="c-1055-1500"></td>
                            <td class="coolant-total" data-row="c-1055-1500">$3,375.00</td>
                            <td><input type="number" value="850" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1500-2050</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="c-1500-2050" data-service="c"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="c-1500-2050" data-service="c"></td>
                            <td class="total-hours" data-row="c-1500-2050">10.0</td>
                            <td class="total-labor" data-row="c-1500-2050">$1,910.00</td>
                            <td><input type="number" class="coolant-gallons" value="225" step="5" data-row="c-1500-2050"></td>
                            <td class="coolant-total" data-row="c-1500-2050">$5,062.50</td>
                            <td><input type="number" value="1000" step="10"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service D - Oil, Fuel & Coolant Analysis -->
            <div class="tab-panel" id="service-d">
                <h2 class="section-title">Service D - Oil, Fuel & Coolant Analysis</h2>
                <div class="info-box">
                    Fluid analysis service - Fixed costs independent of generator size
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>Analysis Type</th>
                            <th>Cost per Analysis</th>
                            <th>Frequency</th>
                            <th>Annual Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="analysis-type">Oil Analysis</td>
                            <td><input type="number" id="oil-analysis-cost" value="16.55" step="0.01"></td>
                            <td>With each oil change</td>
                            <td class="annual-cost" id="oil-analysis-annual">$16.55</td>
                        </tr>
                        <tr>
                            <td class="analysis-type">Coolant Analysis</td>
                            <td><input type="number" id="coolant-analysis-cost" value="16.55" step="0.01"></td>
                            <td>With each coolant service</td>
                            <td class="annual-cost" id="coolant-analysis-annual">$16.55</td>
                        </tr>
                        <tr>
                            <td class="analysis-type">Fuel Analysis</td>
                            <td><input type="number" id="fuel-analysis-cost" value="60.00" step="0.01"></td>
                            <td>Annual or as needed</td>
                            <td class="annual-cost" id="fuel-analysis-annual">$60.00</td>
                        </tr>
                        <tr class="total-row">
                            <td><strong>Total Analysis Cost</strong></td>
                            <td colspan="2"></td>
                            <td class="total-analysis-cost"><strong>$93.10</strong></td>
                        </tr>
                    </tbody>
                </table>
                <div class="info-box" style="margin-top: 15px;">
                    <strong>Note:</strong> Oil analysis is typically performed with Service B (Oil & Filter). 
                    Coolant analysis is performed with Service C (Coolant Service).
                    Fuel analysis helps detect contamination and quality issues.
                </div>
            </div>

            <!-- Fuel Polishing Service -->
            <div class="tab-panel" id="fuel-polish">
                <h2 class="section-title">Fuel Polishing Service</h2>
                <div class="info-box">
                    Fuel cleaning and conditioning service for diesel generators.
                    Service includes fuel sampling, filtration, water removal, and additive treatment.
                </div>

                <div class="fuel-polish-config">
                    <h3>Fuel Tank Capacity Configuration</h3>
                    <table class="service-table">
                        <thead>
                            <tr>
                                <th>kW Range</th>
                                <th>Typical Tank Size (gallons)</th>
                                <th>Price per Gallon</th>
                                <th>Labor Hours</th>
                                <th>Mobilization</th>
                                <th>Equipment Charge</th>
                                <th>Total Service Cost</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="kw-range-label">2-30</td>
                                <td><input type="number" class="tank-size" value="50" step="10" data-row="fp-2-30"></td>
                                <td><input type="number" class="price-per-gallon" value="3.50" step="0.25" data-row="fp-2-30"></td>
                                <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="fp-2-30" data-service="fuel-polish"></td>
                                <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="fp-2-30" data-service="fuel-polish"></td>
                                <td><input type="number" class="equipment-charge" value="250" step="25" data-row="fp-2-30"></td>
                                <td class="fuel-polish-total" data-row="fp-2-30">$1,189.00</td>
                            </tr>
                            <tr>
                                <td class="kw-range-label">35-150</td>
                                <td><input type="number" class="tank-size" value="200" step="25" data-row="fp-35-150"></td>
                                <td><input type="number" class="price-per-gallon" value="3.50" step="0.25" data-row="fp-35-150"></td>
                                <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="fp-35-150" data-service="fuel-polish"></td>
                                <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="fp-35-150" data-service="fuel-polish"></td>
                                <td><input type="number" class="equipment-charge" value="350" step="25" data-row="fp-35-150"></td>
                                <td class="fuel-polish-total" data-row="fp-35-150">$2,196.00</td>
                            </tr>
                            <tr>
                                <td class="kw-range-label">155-250</td>
                                <td><input type="number" class="tank-size" value="500" step="50" data-row="fp-155-250"></td>
                                <td><input type="number" class="price-per-gallon" value="3.50" step="0.25" data-row="fp-155-250"></td>
                                <td><input type="number" class="labor-hours" value="6" step="0.5" data-row="fp-155-250" data-service="fuel-polish"></td>
                                <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="fp-155-250" data-service="fuel-polish"></td>
                                <td><input type="number" class="equipment-charge" value="500" step="25" data-row="fp-155-250"></td>
                                <td class="fuel-polish-total" data-row="fp-155-250">$3,778.00</td>
                            </tr>
                            <tr>
                                <td class="kw-range-label">300-500</td>
                                <td><input type="number" class="tank-size" value="1000" step="100" data-row="fp-300-500"></td>
                                <td><input type="number" class="price-per-gallon" value="3.50" step="0.25" data-row="fp-300-500"></td>
                                <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="fp-300-500" data-service="fuel-polish"></td>
                                <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="fp-300-500" data-service="fuel-polish"></td>
                                <td><input type="number" class="equipment-charge" value="750" step="25" data-row="fp-300-500"></td>
                                <td class="fuel-polish-total" data-row="fp-300-500">$6,160.00</td>
                            </tr>
                            <tr>
                                <td class="kw-range-label">600-1000</td>
                                <td><input type="number" class="tank-size" value="2000" step="100" data-row="fp-600-1000"></td>
                                <td><input type="number" class="price-per-gallon" value="3.50" step="0.25" data-row="fp-600-1000"></td>
                                <td><input type="number" class="labor-hours" value="10" step="0.5" data-row="fp-600-1000" data-service="fuel-polish"></td>
                                <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="fp-600-1000" data-service="fuel-polish"></td>
                                <td><input type="number" class="equipment-charge" value="1000" step="50" data-row="fp-600-1000"></td>
                                <td class="fuel-polish-total" data-row="fp-600-1000">$10,292.00</td>
                            </tr>
                            <tr>
                                <td class="kw-range-label">1250-3000</td>
                                <td><input type="number" class="tank-size" value="4000" step="250" data-row="fp-1250-3000"></td>
                                <td><input type="number" class="price-per-gallon" value="3.50" step="0.25" data-row="fp-1250-3000"></td>
                                <td><input type="number" class="labor-hours" value="12" step="0.5" data-row="fp-1250-3000" data-service="fuel-polish"></td>
                                <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="fp-1250-3000" data-service="fuel-polish"></td>
                                <td><input type="number" class="equipment-charge" value="1500" step="100" data-row="fp-1250-3000"></td>
                                <td class="fuel-polish-total" data-row="fp-1250-3000">$18,174.00</td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="fuel-polish-options">
                        <h3>Additional Options</h3>
                        <div class="option-group">
                            <label>
                                <input type="checkbox" id="fuel-polish-testing" checked>
                                Include fuel quality testing ($250)
                            </label>
                        </div>
                        <div class="option-group">
                            <label>
                                <input type="checkbox" id="fuel-polish-biocide" checked>
                                Include biocide treatment ($150)
                            </label>
                        </div>
                        <div class="option-group">
                            <label>
                                <input type="checkbox" id="fuel-polish-additives" checked>
                                Include fuel stabilizer additives ($200)
                            </label>
                        </div>
                        <div class="option-group">
                            <label>
                                Frequency:
                                <select id="fuel-polish-frequency">
                                    <option value="1">Annual (Recommended)</option>
                                    <option value="2">Semi-Annual</option>
                                    <option value="4">Quarterly</option>
                                    <option value="0">As Needed</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Battery Service -->
            <div class="tab-panel" id="battery">
                <h2 class="section-title">Battery Service (As Needed)</h2>
                <div class="info-box">
                    Battery replacement service - Can be done independently or with other services
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Range</th>
                            <th>Battery Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Total Hours</th>
                            <th>Total Labor</th>
                            <th>Battery Cost (AMG)</th>
                            <th>Quantity</th>
                            <th>Total Battery Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">2-14</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="bat-2-14" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-2-14" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-2-14">4.0</td>
                            <td class="total-labor" data-row="bat-2-14">$764.00</td>
                            <td><input type="number" class="battery-cost" value="100" step="10" data-row="bat-2-14"></td>
                            <td><input type="number" class="battery-qty" value="1" step="1" data-row="bat-2-14"></td>
                            <td class="battery-total" data-row="bat-2-14">$100.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">15-30</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="bat-15-30" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-15-30" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-15-30">4.0</td>
                            <td class="total-labor" data-row="bat-15-30">$764.00</td>
                            <td><input type="number" class="battery-cost" value="100" step="10" data-row="bat-15-30"></td>
                            <td><input type="number" class="battery-qty" value="1" step="1" data-row="bat-15-30"></td>
                            <td class="battery-total" data-row="bat-15-30">$100.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">35-150</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="bat-35-150" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-35-150" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-35-150">4.0</td>
                            <td class="total-labor" data-row="bat-35-150">$764.00</td>
                            <td><input type="number" class="battery-cost" value="150" step="10" data-row="bat-35-150"></td>
                            <td><input type="number" class="battery-qty" value="1" step="1" data-row="bat-35-150"></td>
                            <td class="battery-total" data-row="bat-35-150">$150.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">155-250</td>
                            <td><input type="number" class="labor-hours" value="2" step="0.5" data-row="bat-155-250" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-155-250" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-155-250">4.0</td>
                            <td class="total-labor" data-row="bat-155-250">$764.00</td>
                            <td><input type="number" class="battery-cost" value="350" step="10" data-row="bat-155-250"></td>
                            <td><input type="number" class="battery-qty" value="1" step="1" data-row="bat-155-250"></td>
                            <td class="battery-total" data-row="bat-155-250">$350.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">255-400</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="bat-255-400" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-255-400" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-255-400">6.0</td>
                            <td class="total-labor" data-row="bat-255-400">$1,146.00</td>
                            <td><input type="number" class="battery-cost" value="600" step="10" data-row="bat-255-400"></td>
                            <td><input type="number" class="battery-qty" value="1" step="1" data-row="bat-255-400"></td>
                            <td class="battery-total" data-row="bat-255-400">$600.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">405-500</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="bat-405-500" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-405-500" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-405-500">6.0</td>
                            <td class="total-labor" data-row="bat-405-500">$1,146.00</td>
                            <td><input type="number" class="battery-cost" value="1200" step="10" data-row="bat-405-500"></td>
                            <td><input type="number" class="battery-qty" value="2" step="1" data-row="bat-405-500"></td>
                            <td class="battery-total" data-row="bat-405-500">$2,400.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">505-670</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="bat-505-670" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-505-670" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-505-670">6.0</td>
                            <td class="total-labor" data-row="bat-505-670">$1,146.00</td>
                            <td><input type="number" class="battery-cost" value="1250" step="10" data-row="bat-505-670"></td>
                            <td><input type="number" class="battery-qty" value="2" step="1" data-row="bat-505-670"></td>
                            <td class="battery-total" data-row="bat-505-670">$2,500.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">675-1050</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="bat-675-1050" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-675-1050" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-675-1050">10.0</td>
                            <td class="total-labor" data-row="bat-675-1050">$1,910.00</td>
                            <td><input type="number" class="battery-cost" value="1750" step="10" data-row="bat-675-1050"></td>
                            <td><input type="number" class="battery-qty" value="2" step="1" data-row="bat-675-1050"></td>
                            <td class="battery-total" data-row="bat-675-1050">$3,500.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1055-1500</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="bat-1055-1500" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-1055-1500" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-1055-1500">10.0</td>
                            <td class="total-labor" data-row="bat-1055-1500">$1,910.00</td>
                            <td><input type="number" class="battery-cost" value="2400" step="10" data-row="bat-1055-1500"></td>
                            <td><input type="number" class="battery-qty" value="2" step="1" data-row="bat-1055-1500"></td>
                            <td class="battery-total" data-row="bat-1055-1500">$4,800.00</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1500-2050</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="bat-1500-2050" data-service="battery"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="bat-1500-2050" data-service="battery"></td>
                            <td class="total-hours" data-row="bat-1500-2050">10.0</td>
                            <td class="total-labor" data-row="bat-1500-2050">$1,910.00</td>
                            <td><input type="number" class="battery-cost" value="2500" step="10" data-row="bat-1500-2050"></td>
                            <td><input type="number" class="battery-qty" value="2" step="1" data-row="bat-1500-2050"></td>
                            <td class="battery-total" data-row="bat-1500-2050">$5,000.00</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service E - Load Bank Testing -->
            <div class="tab-panel" id="service-e">
                <h2 class="section-title">Service E - Load Bank Testing (Annual)</h2>
                <div class="info-box">
                    Excel Data from 'Ser Menu 2022 Rates' sheet - Exact values with calculated labor totals
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Range</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Total Hours</th>
                            <th>Total Labor</th>
                            <th>Load Bank Rental</th>
                            <th>Transformer Rental</th>
                            <th>Delivery Cost</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">2-14</td>
                            <td><input type="number" class="labor-hours" value="3" step="0.5" data-row="e-2-14" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-2-14" data-service="e"></td>
                            <td class="total-hours" data-row="e-2-14">5.0</td>
                            <td class="total-labor" data-row="e-2-14">$955.00</td>
                            <td><input type="number" value="350" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">15-30</td>
                            <td><input type="number" class="labor-hours" value="3" step="0.5" data-row="e-15-30" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-15-30" data-service="e"></td>
                            <td class="total-hours" data-row="e-15-30">5.0</td>
                            <td class="total-labor" data-row="e-15-30">$955.00</td>
                            <td><input type="number" value="350" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">35-150</td>
                            <td><input type="number" class="labor-hours" value="3" step="0.5" data-row="e-35-150" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-35-150" data-service="e"></td>
                            <td class="total-hours" data-row="e-35-150">5.0</td>
                            <td class="total-labor" data-row="e-35-150">$955.00</td>
                            <td><input type="number" value="350" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">155-250</td>
                            <td><input type="number" class="labor-hours" value="4" step="0.5" data-row="e-155-250" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-155-250" data-service="e"></td>
                            <td class="total-hours" data-row="e-155-250">6.0</td>
                            <td class="total-labor" data-row="e-155-250">$1,146.00</td>
                            <td><input type="number" value="700" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">255-400</td>
                            <td><input type="number" class="labor-hours" value="6" step="0.5" data-row="e-255-400" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-255-400" data-service="e"></td>
                            <td class="total-hours" data-row="e-255-400">8.0</td>
                            <td class="total-labor" data-row="e-255-400">$1,528.00</td>
                            <td><input type="number" value="700" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">405-500</td>
                            <td><input type="number" class="labor-hours" value="6" step="0.5" data-row="e-405-500" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-405-500" data-service="e"></td>
                            <td class="total-hours" data-row="e-405-500">8.0</td>
                            <td class="total-labor" data-row="e-405-500">$1,528.00</td>
                            <td><input type="number" value="1000" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                            <td><input type="number" value="0" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">505-670</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="e-505-670" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-505-670" data-service="e"></td>
                            <td class="total-hours" data-row="e-505-670">10.0</td>
                            <td class="total-labor" data-row="e-505-670">$1,910.00</td>
                            <td><input type="number" value="1500" step="50"></td>
                            <td><input type="number" value="1500" step="50"></td>
                            <td><input type="number" value="3500" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">675-1050</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="e-675-1050" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-675-1050" data-service="e"></td>
                            <td class="total-hours" data-row="e-675-1050">10.0</td>
                            <td class="total-labor" data-row="e-675-1050">$1,910.00</td>
                            <td><input type="number" value="1500" step="50"></td>
                            <td><input type="number" value="1500" step="50"></td>
                            <td><input type="number" value="3500" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1055-1500</td>
                            <td><input type="number" class="labor-hours" value="8" step="0.5" data-row="e-1055-1500" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-1055-1500" data-service="e"></td>
                            <td class="total-hours" data-row="e-1055-1500">10.0</td>
                            <td class="total-labor" data-row="e-1055-1500">$1,910.00</td>
                            <td><input type="number" value="2000" step="50"></td>
                            <td><input type="number" value="1500" step="50"></td>
                            <td><input type="number" value="3500" step="50"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1500-2050</td>
                            <td><input type="number" class="labor-hours" value="12" step="0.5" data-row="e-1500-2050" data-service="e"></td>
                            <td><input type="number" class="mobilization-hours" value="2" step="0.5" data-row="e-1500-2050" data-service="e"></td>
                            <td class="total-hours" data-row="e-1500-2050">14.0</td>
                            <td class="total-labor" data-row="e-1500-2050">$2,674.00</td>
                            <td><input type="number" value="2500" step="50"></td>
                            <td><input type="number" value="1500" step="50"></td>
                            <td><input type="number" value="3500" step="50"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service F - Diesel Tune-Up -->
            <div class="tab-panel" id="service-f">
                <h2 class="section-title">Service F - Engine Tune-Up (Diesel) - By Cylinder Count</h2>
                <div class="info-box">
                    Excel Data: Varies by cylinder count (4, 6, 8, 12, 16) and injector type (Pop vs Unit)
                </div>
                <h3 style="color: var(--accent-electric); margin: 20px 0 10px;">Pop Nozzle Injectors</h3>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>Cylinders</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Parts Cost ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">4 Cylinder</td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="250" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">6 Cylinder</td>
                            <td><input type="number" value="3" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="350" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">8 Cylinder</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="450" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">12 Cylinder</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="550" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">16 Cylinder</td>
                            <td><input type="number" value="6" step="0.5"></td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="750" step="10"></td>
                        </tr>
                    </tbody>
                </table>

                <h3 style="color: var(--accent-electric); margin: 20px 0 10px;">Unit Injectors</h3>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>Cylinders</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Parts Cost ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">4 Cylinder</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="450" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">6 Cylinder</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="550" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">8 Cylinder</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="650" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">12 Cylinder</td>
                            <td><input type="number" value="7" step="0.5"></td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="850" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">16 Cylinder</td>
                            <td><input type="number" value="10" step="0.5"></td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="1050" step="10"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service G - Gas Engine Tune-Up -->
            <div class="tab-panel" id="service-g">
                <h2 class="section-title">Service G - Gas Engine Tune-Up - By Cylinder Count</h2>
                <div class="info-box">
                    Includes spark plugs ($25 each) and ignition kit
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>Cylinders</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Spark Plugs</th>
                            <th>Plug Cost ($ each)</th>
                            <th>Ignition Kit ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">4 Cylinder</td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td>4</td>
                            <td><input type="number" value="25" step="1"></td>
                            <td><input type="number" value="150" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">6 Cylinder</td>
                            <td><input type="number" value="3" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td>6</td>
                            <td><input type="number" value="25" step="1"></td>
                            <td><input type="number" value="175" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">8 Cylinder</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td>8</td>
                            <td><input type="number" value="25" step="1"></td>
                            <td><input type="number" value="200" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">10 Cylinder</td>
                            <td><input type="number" value="5" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td>10</td>
                            <td><input type="number" value="25" step="1"></td>
                            <td><input type="number" value="225" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">12 Cylinder</td>
                            <td><input type="number" value="6" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td>12</td>
                            <td><input type="number" value="25" step="1"></td>
                            <td><input type="number" value="275" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">16 Cylinder</td>
                            <td><input type="number" value="8" step="0.5"></td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td>16</td>
                            <td><input type="number" value="25" step="1"></td>
                            <td><input type="number" value="350" step="10"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service H - Electrical Testing -->
            <div class="tab-panel" id="service-h">
                <h2 class="section-title">Service H - Generator Electrical Testing (Every 5 Years)</h2>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Range</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Testing Equipment ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">2-14</td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="250" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">15-30</td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="250" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">35-150</td>
                            <td><input type="number" value="3" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="350" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">155-250</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="450" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">255-400</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="450" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">405-500</td>
                            <td><input type="number" value="6" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="650" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">505-670</td>
                            <td><input type="number" value="6" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="650" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">675-1050</td>
                            <td><input type="number" value="8" step="0.5"></td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="850" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1055-1500</td>
                            <td><input type="number" value="8" step="0.5"></td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="850" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1500-2050</td>
                            <td><input type="number" value="8" step="0.5"></td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="850" step="10"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service I - Transfer Switch -->
            <div class="tab-panel" id="service-i">
                <h2 class="section-title">Service I - Transfer Switch Service (Annual)</h2>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Range</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Switch Maintenance ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">2-14</td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="150" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">15-30</td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="150" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">35-150</td>
                            <td><input type="number" value="3" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="200" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">155-250</td>
                            <td><input type="number" value="3" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="200" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">255-400</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="250" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">405-500</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="250" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">505-670</td>
                            <td><input type="number" value="6" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="350" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">675-1050</td>
                            <td><input type="number" value="6" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="350" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1055-1500</td>
                            <td><input type="number" value="8" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="450" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">1500-2050</td>
                            <td><input type="number" value="8" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="450" step="10"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Service J - Thermal Imaging -->
            <div class="tab-panel" id="service-j">
                <h2 class="section-title">Service J - Thermal Imaging Scan</h2>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>kW Category</th>
                            <th>Labor Hours</th>
                            <th>Mobilization</th>
                            <th>Equipment Cost ($)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">Up to 150 kW</td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="100" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">151-500 kW</td>
                            <td><input type="number" value="3" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="150" step="10"></td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Over 500 kW</td>
                            <td><input type="number" value="4" step="0.5"></td>
                            <td><input type="number" value="2" step="0.5"></td>
                            <td><input type="number" value="200" step="10"></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Frequency Matrix -->
            <div class="tab-panel" id="frequency">
                <h2 class="section-title">Service Frequency Matrix</h2>
                <div class="info-box">
                    Default service frequencies based on best practices and manufacturer recommendations.<br>
                    <strong>Note:</strong> Services F, G, and H are specialty services only added upon Energen representative recommendation.
                </div>
                <table class="service-table">
                    <thead>
                        <tr>
                            <th>Service</th>
                            <th>Description</th>
                            <th>Default Frequency</th>
                            <th>Times Per Year</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="kw-range-label">Service A</td>
                            <td>Comprehensive Inspection</td>
                            <td>
                                <select>
                                    <option value="4" selected>Quarterly</option>
                                    <option value="2">Semi-Annual</option>
                                    <option value="1">Annual</option>
                                </select>
                            </td>
                            <td>4</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service B</td>
                            <td>Oil & Filter Service</td>
                            <td>
                                <select>
                                    <option value="4">Quarterly</option>
                                    <option value="2">Semi-Annual</option>
                                    <option value="1" selected>Annual</option>
                                </select>
                            </td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service C</td>
                            <td>Coolant Service</td>
                            <td>
                                <select>
                                    <option value="1" selected>Annual</option>
                                    <option value="0.5">Biannual</option>
                                </select>
                            </td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service D</td>
                            <td>Oil & Fuel Analysis</td>
                            <td>
                                <select>
                                    <option value="2">Semi-Annual</option>
                                    <option value="1" selected>Annual</option>
                                </select>
                            </td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service E</td>
                            <td>Load Bank Testing</td>
                            <td>
                                <select>
                                    <option value="1" selected>Annual</option>
                                    <option value="0.5">Biannual</option>
                                </select>
                            </td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service F</td>
                            <td>Diesel Tune-Up</td>
                            <td>
                                <select>
                                    <option value="0" selected>Not Included</option>
                                    <option value="0.5">Biannual</option>
                                    <option value="0.33">Every 3 Years</option>
                                    <option value="0.2">Every 5 Years</option>
                                </select>
                            </td>
                            <td>0</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service G</td>
                            <td>Gas Tune-Up</td>
                            <td>
                                <select>
                                    <option value="0" selected>Not Included</option>
                                    <option value="0.5">Biannual</option>
                                    <option value="0.33">Every 3 Years</option>
                                    <option value="0.2">Every 5 Years</option>
                                </select>
                            </td>
                            <td>0</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service H</td>
                            <td>Electrical Testing</td>
                            <td>
                                <select>
                                    <option value="0" selected>Not Included</option>
                                    <option value="0.33">Every 3 Years</option>
                                    <option value="0.2">Every 5 Years</option>
                                    <option value="0.14">Every 7 Years</option>
                                </select>
                            </td>
                            <td>0</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service I</td>
                            <td>Transfer Switch</td>
                            <td>
                                <select>
                                    <option value="2">Semi-Annual</option>
                                    <option value="1" selected>Annual</option>
                                </select>
                            </td>
                            <td>1</td>
                        </tr>
                        <tr>
                            <td class="kw-range-label">Service J</td>
                            <td>Thermal Imaging</td>
                            <td>
                                <select>
                                    <option value="1" selected>Annual</option>
                                    <option value="0.5">Biannual</option>
                                </select>
                            </td>
                            <td>1</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Tax & Fees -->
            <div class="tab-panel" id="tax-fees">
                <h2 class="section-title">Tax & Additional Fees</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Default Sales Tax Rate (%)</label>
                        <input type="number" id="defaultTaxRate" value="8.75" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>Environmental Disposal Fee ($)</label>
                        <input type="number" id="disposalFee" value="35.00" step="5">
                    </div>
                    <div class="form-group">
                        <label>Permit Fee ($)</label>
                        <input type="number" id="permitFee" value="250.00" step="25">
                    </div>
                    <div class="form-group">
                        <label>Emergency Response Fee ($)</label>
                        <input type="number" id="emergencyFee" value="500.00" step="50">
                    </div>
                    <div class="form-group">
                        <label>After Hours Surcharge (%)</label>
                        <input type="number" id="afterHoursSurcharge" value="50" step="5">
                    </div>
                    <div class="form-group">
                        <label>Weekend Surcharge (%)</label>
                        <input type="number" id="weekendSurcharge" value="25" step="5">
                    </div>
                </div>
            </div>

            <!-- Company Info -->
            <div class="tab-panel" id="company">
                <h2 class="section-title">Company Information</h2>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Company Name</label>
                        <input type="text" id="companyName" value="Energen Systems Inc.">
                    </div>
                    <div class="form-group">
                        <label>License Number</label>
                        <input type="text" id="licenseNumber" value="1143462">
                    </div>
                    <div class="form-group">
                        <label>Address</label>
                        <input type="text" id="companyAddress" value="150 Mason Circle, Suite K">
                    </div>
                    <div class="form-group">
                        <label>City</label>
                        <input type="text" id="companyCity" value="Concord">
                    </div>
                    <div class="form-group">
                        <label>State</label>
                        <input type="text" id="companyState" value="CA">
                    </div>
                    <div class="form-group">
                        <label>ZIP Code</label>
                        <input type="text" id="companyZip" value="94520">
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" id="companyPhone" value="(925) 289-8969">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="companyEmail" value="service@energensystems.com">
                    </div>
                    <div class="form-group">
                        <label>Website</label>
                        <input type="url" id="companyWebsite" value="https://energensystems.com">
                    </div>
                    <div class="form-group">
                        <label>Default Payment Terms</label>
                        <select id="paymentTerms">
                            <option value="net30" selected>Net 30</option>
                            <option value="net15">Net 15</option>
                            <option value="net45">Net 45</option>
                            <option value="due">Due on Receipt</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Bar -->
        <div class="action-bar">
            <button class="btn" onclick="resetToDefaults()">Reset to Excel Defaults</button>
            <button class="btn" onclick="exportSettings()">Export Settings</button>
            <button class="btn" onclick="importSettings()">Import Settings</button>
            <button class="btn" onclick="closeSettings()">Cancel</button>
            <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
    </div>

    <script>
        // Auto-calculate overtime and double-time rates based on base labor rate
        function updateCalculatedRates() {
            const baseRate = parseFloat(document.getElementById('laborRate').value) ;
            
            // California prevailing wage formulas
            const overtimeRate = baseRate * 1.5;
            const doubleTimeRate = baseRate * 2.0;
            
            // Update display fields
            document.getElementById('overtimeRate').value = overtimeRate.toFixed(2);
            document.getElementById('doubleTimeRate').value = doubleTimeRate.toFixed(2);
            
            // Also update travel time rate (typically 50% of base rate)
            const travelRate = baseRate * 0.5;
            document.getElementById('shopRate').value = travelRate.toFixed(2);
            
            // Notify parent window of rate changes
            if (window.parent && window.parent.postMessage) {
                window.parent.postMessage({
                    type: 'LABOR_RATES_UPDATED',
                    rates: {
                        laborRate: baseRate,
                        overtimeRate: overtimeRate,
                        doubleTimeRate: doubleTimeRate,
                        travelTimeRate: travelRate
                    }
                }, '*');
            }
            
            // Trigger recalculation
            recalculateTotals();
        }

        // Tab switching
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active from all tabs and panels
                document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
                
                // Add active to clicked tab and corresponding panel
                tab.classList.add('active');
                const panelId = tab.dataset.tab;
                document.getElementById(panelId).classList.add('active');
            });
        });

        // Auto-calculate totals when inputs change
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', recalculateTotals);
        });
        
        // Handle frequency changes
        document.querySelectorAll('#frequency select').forEach(select => {
            select.addEventListener('change', function() {
                const row = this.closest('tr');
                const frequencyCell = row.querySelector('td:last-child');
                frequencyCell.textContent = this.value;
            });
        });
        
        // Listen for messages from parent window (prevailing wage data)
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'LOAD_SETTINGS') {
                // Load settings if provided
                if (event.data.settings) {
                    // Handle regular settings...
                }
                
                // Load prevailing wage data if provided
                if (event.data.prevailingWageData) {
                    const data = event.data.prevailingWageData;
                    
                    // Populate prevailing wage fields
                    const electricianInput = document.getElementById('prevailingElectrician');
                    const foremanInput = document.getElementById('prevailingForeman');
                    const totalInput = document.getElementById('prevailingTotal');
                    
                    if (electricianInput && data.prevailingWage) {
                        electricianInput.value = data.prevailingWage.electricianJourneyman?.toFixed(2) || '';
                    }
                    if (foremanInput && data.prevailingWage) {
                        foremanInput.value = data.prevailingWage.electricianForeman?.toFixed(2) || '';
                    }
                    if (totalInput && data.prevailingWage) {
                        totalInput.value = data.prevailingWage.totalHourly?.toFixed(2) || '';
                    }
                    
                    // Populate per diem fields
                    const lodgingInput = document.getElementById('perDiemLodging');
                    const mealsInput = document.getElementById('perDiemMeals');
                    const perDiemTotalInput = document.getElementById('perDiemTotal');
                    
                    if (lodgingInput && data.perDiem) {
                        lodgingInput.value = data.perDiem.lodging || '';
                    }
                    if (mealsInput && data.perDiem) {
                        mealsInput.value = data.perDiem.meals || '';
                    }
                    if (perDiemTotalInput && data.perDiem) {
                        perDiemTotalInput.value = data.perDiem.total || '';
                    }
                }
            }
        });
        
        // Initialize calculations on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('=== Settings Modal DOMContentLoaded ===');

            // Load saved settings from localStorage
            const savedSettings = localStorage.getItem('energenSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    console.log('Loading saved settings. Labor rate:', settings.laborRate);

                    // Populate form fields with saved values
                    if (settings.laborRate !== undefined && document.getElementById('laborRate')) {
                        document.getElementById('laborRate').value = settings.laborRate;
                    }
                    if (settings.mobilizationRate !== undefined && document.getElementById('mobilizationRate')) {
                        document.getElementById('mobilizationRate').value = settings.mobilizationRate;
                    } else if (settings.laborRate !== undefined && document.getElementById('mobilizationRate')) {
                        // Default mobilization rate to labor rate if not set
                        document.getElementById('mobilizationRate').value = settings.laborRate;
                    }
                    if (settings.mileageRate !== undefined && document.getElementById('mileageRate')) {
                        document.getElementById('mileageRate').value = settings.mileageRate;
                    }
                    if (settings.overtimeRate !== undefined && document.getElementById('overtimeRate')) {
                        document.getElementById('overtimeRate').value = settings.overtimeRate;
                    }
                    if (settings.doubleTimeRate !== undefined && document.getElementById('doubleTimeRate')) {
                        document.getElementById('doubleTimeRate').value = settings.doubleTimeRate;
                    }
                    if (settings.travelTimeRate !== undefined && document.getElementById('travelRate')) {
                        document.getElementById('travelRate').value = settings.travelTimeRate;
                    }
                    // NEW: Load shop location and distance fields
                    if (settings.shopAddress !== undefined && document.getElementById('shopAddress')) {
                        document.getElementById('shopAddress').value = settings.shopAddress;
                    }
                    if (settings.distanceFromShop !== undefined && document.getElementById('distanceFromShop')) {
                        document.getElementById('distanceFromShop').value = settings.distanceFromShop;
                    }
                    if (settings.currentTaxRate !== undefined && document.getElementById('currentTaxRate')) {
                        document.getElementById('currentTaxRate').value = settings.currentTaxRate;
                    }
                    if (settings.oilCost !== undefined && document.getElementById('oilCost')) {
                        document.getElementById('oilCost').value = settings.oilCost;
                    }
                    if (settings.coolantCost !== undefined && document.getElementById('coolantCost')) {
                        document.getElementById('coolantCost').value = settings.coolantCost;
                    }
                    if (settings.oilAnalysisCost !== undefined && document.getElementById('oilAnalysisCost')) {
                        document.getElementById('oilAnalysisCost').value = settings.oilAnalysisCost;
                    }

                    console.log('Settings loaded into form fields');
                } catch (e) {
                    console.error('Error loading saved settings:', e);
                }
            } else {
                console.log('No saved settings found, using defaults');
            }

            // Set up event listeners for labor rate changes
            const laborRateInput = document.getElementById('laborRate');
            if (laborRateInput) {
                laborRateInput.addEventListener('input', recalculateTotals);
            }
            
            // Set up event listeners for coolant cost and markup changes
            const coolantCostInput = document.getElementById('coolantCost');
            const coolantMarkupInput = document.getElementById('coolantMarkup');
            if (coolantCostInput) {
                coolantCostInput.addEventListener('input', recalculateTotals);
            }
            if (coolantMarkupInput) {
                coolantMarkupInput.addEventListener('input', recalculateTotals);
            }
            
            // Set up event listeners for service hour inputs
            document.querySelectorAll('.labor-hours, .mobilization-hours').forEach(input => {
                input.addEventListener('input', recalculateTotals);
            });
            
            // Set up event listeners for coolant gallon inputs
            document.querySelectorAll('.coolant-gallons').forEach(input => {
                input.addEventListener('input', recalculateTotals);
            });
            
            // Set up event listeners for battery inputs
            document.querySelectorAll('.battery-cost, .battery-qty').forEach(input => {
                input.addEventListener('input', recalculateTotals);
            });

            // Set up event listeners for fuel polishing inputs
            document.querySelectorAll('.tank-size, .price-per-gallon, .equipment-charge').forEach(input => {
                input.addEventListener('input', recalculateTotals);
            });

            // Set up event listeners for fuel polishing checkboxes
            document.querySelectorAll('#fuel-polish-testing, #fuel-polish-biocide, #fuel-polish-additives').forEach(checkbox => {
                checkbox.addEventListener('change', recalculateTotals);
            });
            
            // Set up event listeners for Service D analysis costs
            const oilAnalysisInput = document.getElementById('oil-analysis-cost');
            const fuelAnalysisInput = document.getElementById('fuel-analysis-cost');
            const coolantAnalysisInput = document.getElementById('coolant-analysis-cost');
            
            if (oilAnalysisInput) {
                oilAnalysisInput.addEventListener('input', updateAnalysisCosts);
            }
            if (fuelAnalysisInput) {
                fuelAnalysisInput.addEventListener('input', updateAnalysisCosts);
            }
            if (coolantAnalysisInput) {
                coolantAnalysisInput.addEventListener('input', updateAnalysisCosts);
            }
            
            // Initial calculation
            recalculateTotals();
            updateAnalysisCosts();
        });
        
        // Also trigger recalculation when switching tabs
        document.querySelectorAll('.tab-item').forEach(tab => {
            tab.addEventListener('click', () => {
                setTimeout(recalculateTotals, 100); // Small delay to ensure DOM is updated
            });
        });

        function recalculateTotals() {
            // Get the labor rate from the Labor & Travel tab
            // Excel uses same rate for both labor and travel hours (default $191)
            const laborRate = parseFloat(document.getElementById('laborRate')?.value) ;
            
            // Update Service A calculations
            document.querySelectorAll('.labor-hours, .mobilization-hours').forEach(input => {
                const rowId = input.dataset.row;
                if (!rowId) return;
                
                const laborHoursInput = document.querySelector(`.labor-hours[data-row="${rowId}"]`);
                const travelHoursInput = document.querySelector(`.mobilization-hours[data-row="${rowId}"]`);
                const totalHoursCell = document.querySelector(`.total-hours[data-row="${rowId}"]`);
                const totalLaborCell = document.querySelector(`.total-labor[data-row="${rowId}"]`);
                
                if (laborHoursInput && travelHoursInput && totalHoursCell && totalLaborCell) {
                    const laborHours = parseFloat(laborHoursInput.value) || 0;
                    const travelHours = parseFloat(travelHoursInput.value) || 0;
                    
                    // Calculate totals following Excel formulas
                    const totalHours = laborHours + travelHours;
                    const totalLabor = totalHours * laborRate;
                    
                    // Update display
                    totalHoursCell.textContent = totalHours.toFixed(1);
                    totalLaborCell.textContent = '$' + totalLabor.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
            });
            
            // Update other service calculations (B, C, etc.) similarly
            updateAllServiceCalculations(laborRate);
        }
        
        function updateAnalysisCosts() {
            // Update Service D analysis costs
            const oilCost = parseFloat(document.getElementById('oil-analysis-cost')?.value) || 16.55;
            const fuelCost = parseFloat(document.getElementById('fuel-analysis-cost')?.value) || 60.00;
            const coolantCost = parseFloat(document.getElementById('coolant-analysis-cost')?.value) || 16.55;
            
            // Update annual costs (assuming once per year for simplicity)
            const oilAnnualEl = document.getElementById('oil-analysis-annual');
            const fuelAnnualEl = document.getElementById('fuel-analysis-annual');
            const coolantAnnualEl = document.getElementById('coolant-analysis-annual');
            
            if (oilAnnualEl) oilAnnualEl.textContent = '$' + oilCost.toFixed(2);
            if (fuelAnnualEl) fuelAnnualEl.textContent = '$' + fuelCost.toFixed(2);
            if (coolantAnnualEl) coolantAnnualEl.textContent = '$' + coolantCost.toFixed(2);
            
            // Update total
            const total = oilCost + fuelCost + coolantCost;
            const totalEl = document.querySelector('.total-analysis-cost strong');
            if (totalEl) {
                totalEl.textContent = '$' + total.toFixed(2);
            }
        }
        
        function updateAllServiceCalculations(laborRate) {
            // This function will handle calculations for all other services
            // Each service follows the same pattern: Total Hours = Labor + Travel
            // Total Labor = Total Hours √ó Labor Rate
            
            // Get coolant cost and markup for Service C calculations
            const coolantCost = parseFloat(document.getElementById('coolantCost')?.value) || 15.00;
            const coolantMarkup = parseFloat(document.getElementById('coolantMarkup')?.value) || 1.5;
            const coolantPrice = coolantCost * coolantMarkup; // $15 * 1.5 = $22.50 per gallon
            
            // Service B calculations - already updated with new structure
            // Service B now has same structure as Service A, calculations handled by main recalculateTotals
            
            // Service C calculations - includes coolant calculations
            document.querySelectorAll('#service-c tbody tr').forEach(row => {
                const rowId = row.querySelector('.labor-hours')?.dataset.row;
                if (!rowId) return;
                
                // Calculate labor totals
                const laborHoursInput = row.querySelector('.labor-hours');
                const travelHoursInput = row.querySelector('.mobilization-hours');
                const totalHoursCell = row.querySelector('.total-hours');
                const totalLaborCell = row.querySelector('.total-labor');
                
                if (laborHoursInput && travelHoursInput && totalHoursCell && totalLaborCell) {
                    const laborHours = parseFloat(laborHoursInput.value) || 0;
                    const travelHours = parseFloat(travelHoursInput.value) || 0;
                    const totalHours = laborHours + travelHours;
                    const totalLabor = totalHours * laborRate;
                    
                    totalHoursCell.textContent = totalHours.toFixed(1);
                    totalLaborCell.textContent = '$' + totalLabor.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
                
                // Calculate coolant totals
                const coolantGallonsInput = row.querySelector('.coolant-gallons');
                const coolantTotalCell = row.querySelector('.coolant-total');
                
                if (coolantGallonsInput && coolantTotalCell) {
                    const gallons = parseFloat(coolantGallonsInput.value) || 0;
                    const coolantTotal = gallons * coolantPrice;
                    coolantTotalCell.textContent = '$' + coolantTotal.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
            });
            
            // Battery Service calculations
            document.querySelectorAll('#battery tbody tr').forEach(row => {
                const rowId = row.querySelector('.labor-hours')?.dataset.row;
                if (!rowId) return;
                
                // Calculate labor totals
                const laborHoursInput = row.querySelector('.labor-hours');
                const travelHoursInput = row.querySelector('.mobilization-hours');
                const totalHoursCell = row.querySelector('.total-hours');
                const totalLaborCell = row.querySelector('.total-labor');
                
                if (laborHoursInput && travelHoursInput && totalHoursCell && totalLaborCell) {
                    const laborHours = parseFloat(laborHoursInput.value) || 0;
                    const travelHours = parseFloat(travelHoursInput.value) || 0;
                    const totalHours = laborHours + travelHours;
                    const totalLabor = totalHours * laborRate;
                    
                    totalHoursCell.textContent = totalHours.toFixed(1);
                    totalLaborCell.textContent = '$' + totalLabor.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
                
                // Calculate battery totals
                const batteryCostInput = row.querySelector('.battery-cost');
                const batteryQtyInput = row.querySelector('.battery-qty');
                const batteryTotalCell = row.querySelector('.battery-total');
                
                if (batteryCostInput && batteryQtyInput && batteryTotalCell) {
                    const cost = parseFloat(batteryCostInput.value) || 0;
                    const qty = parseFloat(batteryQtyInput.value) || 1;
                    const total = cost * qty;
                    batteryTotalCell.textContent = '$' + total.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
            });

            // Fuel Polishing Service calculations
            document.querySelectorAll('#fuel-polish tbody tr').forEach(row => {
                const rowId = row.querySelector('.tank-size')?.dataset.row;
                if (!rowId) return;

                // Get inputs
                const tankSizeInput = row.querySelector('.tank-size');
                const pricePerGallonInput = row.querySelector('.price-per-gallon');
                const laborHoursInput = row.querySelector('.labor-hours');
                const mobilizationInput = row.querySelector('.mobilization-hours');
                const equipmentChargeInput = row.querySelector('.equipment-charge');
                const totalCell = row.querySelector('.fuel-polish-total');

                if (tankSizeInput && pricePerGallonInput && laborHoursInput &&
                    mobilizationInput && equipmentChargeInput && totalCell) {

                    const tankSize = parseFloat(tankSizeInput.value) || 0;
                    const pricePerGallon = parseFloat(pricePerGallonInput.value) || 0;
                    const laborHours = parseFloat(laborHoursInput.value) || 0;
                    const mobilization = parseFloat(mobilizationInput.value) || 0;
                    const equipmentCharge = parseFloat(equipmentChargeInput.value) || 0;

                    // Calculate fuel polishing cost
                    const fuelCost = tankSize * pricePerGallon;
                    const laborCost = (laborHours + mobilization) * laborRate;

                    // Add optional services if checked
                    let additionalCosts = equipmentCharge;
                    if (document.getElementById('fuel-polish-testing')?.checked) {
                        additionalCosts += 250;
                    }
                    if (document.getElementById('fuel-polish-biocide')?.checked) {
                        additionalCosts += 150;
                    }
                    if (document.getElementById('fuel-polish-additives')?.checked) {
                        additionalCosts += 200;
                    }

                    const totalCost = fuelCost + laborCost + additionalCosts;
                    totalCell.textContent = '$' + totalCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
                }
            });
        }

        function saveSettings() {
            console.log('=== DEBUG: saveSettings() START ===');

            // Validate required fields before saving
            const errors = [];

            // Get values without fallbacks
            const laborRateInput = document.getElementById('laborRate');
            const rawLaborRateValue = laborRateInput.value;
            console.log('1. Raw laborRate input value:', rawLaborRateValue);
            console.log('   Input element exists?', laborRateInput !== null);

            const laborRateValue = parseFloat(rawLaborRateValue);
            console.log('2. Parsed laborRate:', laborRateValue, 'isNaN?', isNaN(laborRateValue));

            const mileageRateInput = document.getElementById('mileageRate');
            const rawMileageRateValue = mileageRateInput.value;
            console.log('3. Raw mileageRate input value:', rawMileageRateValue);

            const mileageRateValue = parseFloat(rawMileageRateValue);
            console.log('4. Parsed mileageRate:', mileageRateValue);

            // Check required fields
            if (!laborRateValue || isNaN(laborRateValue)) {
                errors.push('Labor Rate is required and must be a valid number');
                console.log('ERROR: Labor rate validation failed');
            }
            if (!mileageRateValue || isNaN(mileageRateValue)) {
                errors.push('Mileage Rate is required and must be a valid number');
                console.log('ERROR: Mileage rate validation failed');
            }

            if (errors.length > 0) {
                console.log('VALIDATION ERRORS:', errors);
                alert('Cannot save settings:\n' + errors.join('\n'));
                return;
            }

            console.log('5. Validation passed, proceeding to collect settings...');

            // Collect all settings data - FLAT STRUCTURE for UI compatibility
            const settings = {
                // Labor rates - FLAT for UI integration
                laborRate: laborRateValue,
                overtimeRate: parseFloat(document.getElementById('overtimeRate').value) || 0,
                doubleTimeRate: parseFloat(document.getElementById('doubleTimeRate').value) || 0,
                travelTimeRate: parseFloat(document.getElementById('travelRate')?.value || document.getElementById('travelTimeRate')?.value) || 100.00,
                mileageRate: mileageRateValue,
                // Mobilization rate - defaults to labor rate
                mobilizationRate: parseFloat(document.getElementById('mobilizationRate')?.value) || laborRateValue,
                // Shop location and distance - NEW FIELDS
                shopAddress: document.getElementById('shopAddress')?.value || '150 Mason Circle, Suite K, Concord, CA 94520',
                distanceFromShop: parseFloat(document.getElementById('distanceFromShop')?.value) || 0,
                currentTaxRate: parseFloat(document.getElementById('currentTaxRate')?.value) || 8.4,
                // Materials - FLAT structure
                oilCost: parseFloat(document.getElementById('oilCost')?.value) || 16.00,
                oilMarkup: parseFloat(document.getElementById('oilMarkup')?.value) || 20,
                coolantCost: parseFloat(document.getElementById('coolantCost')?.value) || 25.00,
                coolantMarkup: parseFloat(document.getElementById('coolantMarkup')?.value) || 20,
                partsMarkup: parseFloat(document.getElementById('partsMarkup')?.value) || 20,
                freightRate: parseFloat(document.getElementById('freightRate')?.value) || 5,
                annualEscalation: parseFloat(document.getElementById('annualEscalation')?.value) || 5,
                fuelAnalysisCost: parseFloat(document.getElementById('fuelAnalysisCost')?.value) || 60.00,
                oilAnalysisCost: parseFloat(document.getElementById('oilAnalysisCost')?.value) || 80.00,
                coolantAnalysisCost: parseFloat(document.getElementById('coolantAnalysisCost')?.value || document.getElementById('coolant-analysis-cost')?.value) || 80.00,
                airFilterCost: parseFloat(document.getElementById('airFilterCost')?.value) || 100.00,
                numberOfInspections: parseInt(document.getElementById('numberOfInspections')?.value) || 4,
                transformerRental: parseFloat(document.getElementById('transformerRental')?.value) || 2500,
                deliveryCost: parseFloat(document.getElementById('deliveryCost')?.value) || 250,
                services: collectServiceData(),
                tax: {
                    defaultRate: document.getElementById('defaultTaxRate')?.value || 8.4,
                    disposalFee: document.getElementById('disposalFee')?.value || 35,
                    permitFee: document.getElementById('permitFee')?.value || 250
                },
                company: {
                    name: document.getElementById('companyName')?.value || '',
                    license: document.getElementById('licenseNumber')?.value || '',
                    address: document.getElementById('companyAddress')?.value || '',
                    city: document.getElementById('companyCity')?.value || '',
                    state: document.getElementById('companyState')?.value || '',
                    zip: document.getElementById('companyZip')?.value || '',
                    phone: document.getElementById('companyPhone')?.value || '',
                    email: document.getElementById('companyEmail')?.value || '',
                    website: document.getElementById('companyWebsite')?.value || ''
                },
                prevailingWage: {
                    enabled: document.getElementById('prevailingWageEnabled')?.value || false,
                    electricianJourneyman: document.getElementById('prevailingElectrician')?.value || 75,
                    electricianForeman: document.getElementById('prevailingForeman')?.value || 85,
                    totalWithFringe: document.getElementById('prevailingTotal')?.value || 125,
                    healthWelfare: document.getElementById('prevailingHealth')?.value || 15,
                    pension: document.getElementById('prevailingPension')?.value || 20,
                    vacation: document.getElementById('prevailingVacation')?.value || 10,
                    training: document.getElementById('prevailingTraining')?.value || 5
                },
                perDiem: {
                    lodging: document.getElementById('perDiemLodging')?.value || 150,
                    meals: document.getElementById('perDiemMeals')?.value || 75,
                    total: document.getElementById('perDiemTotal')?.value || 225,
                    mileage: document.getElementById('perDiemMileage')?.value || 0.67
                }
            };
            
            console.log('6. Complete settings object before save:', settings);
            console.log('   laborRate in settings:', settings.laborRate);

            // Save to localStorage
            const settingsJson = JSON.stringify(settings);
            console.log('7. JSON string length:', settingsJson.length);
            console.log('   First 200 chars of JSON:', settingsJson.substring(0, 200));

            localStorage.setItem('energenSettings', settingsJson);
            console.log('8. Saved to localStorage with key "energenSettings"');

            // Verify save
            const verifyRead = localStorage.getItem('energenSettings');
            const verifyParsed = JSON.parse(verifyRead);
            console.log('9. Verification read - laborRate from localStorage:', verifyParsed.laborRate);

            // Send to parent window
            if (window.parent !== window) {
                console.log('10. Sending settings to parent window...');
                window.parent.postMessage({
                    type: 'SAVE_SETTINGS',
                    settings: settings
                }, '*');

                // Also send SETTINGS_UPDATED for immediate application
                window.parent.postMessage({
                    type: 'SETTINGS_UPDATED',
                    settings: settings
                }, '*');
                console.log('11. PostMessage sent to parent');
            }
            
            alert('Settings saved successfully!');
            console.log('=== DEBUG: saveSettings() COMPLETE ===');
        }

        function collectServiceData() {
            // Collect all service configuration data from tables
            const services = {};
            
            // Service A
            services.serviceA = [];
            document.querySelectorAll('#service-a tbody tr').forEach(row => {
                const cells = row.querySelectorAll('input');
                services.serviceA.push({
                    kwRange: row.querySelector('.kw-range-label').textContent,
                    laborHours: parseFloat(cells[0].value) || 0,
                    shopHours: parseFloat(cells[1].value) || 0,
                    parts: parseFloat(cells[2].value) || 0  // NOW collecting parts price!
                });
            });
            
            // Continue for other services...
            
            return services;
        }

        function closeSettings() {
            if (window.parent !== window) {
                window.parent.postMessage({ type: 'CLOSE_SETTINGS' }, '*');
            } else {
                window.close();
            }
        }

        async function resetToDefaults() {
            if (!confirm('Reset all settings to factory defaults? This will overwrite all current settings.')) {
                return;
            }

            try {
                // Import the hard-coded defaults module
                const module = await import('/config/default-settings-constants.js');
                const defaults = module.getDefaultSettings();

                // Apply defaults to all form fields
                document.getElementById('laborRate').value = defaults.laborRate;
                document.getElementById('mobilizationRate').value = defaults.mobilizationRate;
                document.getElementById('travelRate').value = defaults.travelRate;
                document.getElementById('mileageRate').value = defaults.mileageRate;
                document.getElementById('shopAddress').value = defaults.shopAddress;
                document.getElementById('distanceFromShop').value = defaults.defaultDistance;
                document.getElementById('currentTaxRate').value = defaults.defaultTaxRate;
                document.getElementById('defaultTaxRate').value = defaults.defaultTaxRate;
                document.getElementById('disposalFee').value = defaults.disposalFee;
                document.getElementById('permitFee').value = defaults.permitFee;

                // Recalculate overtime rates
                updateOvertimeRates();

                // Save to localStorage
                localStorage.setItem('energenSettings', JSON.stringify(defaults));

                // Notify parent window
                if (window.parent !== window) {
                    window.parent.postMessage({
                        type: 'SETTINGS_UPDATED',
                        settings: defaults
                    }, '*');
                }

                alert('Settings reset to factory defaults');
            } catch (error) {
                console.error('Error resetting to defaults:', error);
                alert('Error resetting settings. Please try again.');
            }
        }

        function exportSettings() {
            const settings = JSON.stringify(collectAllSettings(), null, 2);
            const blob = new Blob([settings], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'energen-settings.json';
            a.click();
        }

        function importSettings() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const settings = JSON.parse(e.target.result);
                        applySettings(settings);
                        alert('Settings imported successfully!');
                    } catch (err) {
                        alert('Error importing settings: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function collectAllSettings() {
            // Comprehensive settings collection
            return {
                version: '4.5.0',
                timestamp: new Date().toISOString(),
                settings: collectServiceData()
            };
        }

        function applySettings(settings) {
            // Apply imported settings to all fields
            // Implementation would populate all form fields
        }

        // Update calculation mode
        function updateCalculationMode() {
            const mode = document.getElementById('calculationMode').value;
            const description = document.getElementById('modeDescription');
            
            if (mode === 'standard') {
                description.innerHTML = `
                    <strong>Standard Mode:</strong> Uses exact values from monterey_mess.xlsx Ser Menu 2022 Rates<br>
                    ‚Ä¢ Service A Parts: $802.20 for 35-150 kW<br>
                    ‚Ä¢ Mobilization: 2 hours √ó $191 = $382<br>
                    ‚Ä¢ Result: ~$10,400 for standard bundle
                `;
                // Update Service A parts for 35-150 kW to standard value
                const serviceATable = document.querySelector('#service-a tbody');
                if (serviceATable) {
                    const row35_150 = serviceATable.querySelector('tr:nth-child(3) td:last-child input');
                    if (row35_150) row35_150.value = '802.20';
                }
            } else {
                description.innerHTML = `
                    <strong>Job-Specific Mode:</strong> Uses simplified calculation for $7,173.50 target<br>
                    ‚Ä¢ Total Parts: $825 (simplified)<br>
                    ‚Ä¢ Parts Markup: 1.2√ó = $990<br>
                    ‚Ä¢ Freight: 5% of marked parts = $49.50<br>
                    ‚Ä¢ Result: $7,173.50 for standard bundle
                `;
                // Update Service A parts for 35-150 kW to simplified value
                const serviceATable = document.querySelector('#service-a tbody');
                if (serviceATable) {
                    const row35_150 = serviceATable.querySelector('tr:nth-child(3) td:last-child input');
                    if (row35_150) row35_150.value = '258.00'; // Simplified parts value
                }
            }
            
            // Store mode in localStorage
            localStorage.setItem('calculationMode', mode);
            
            // Notify parent window if in iframe
            if (window.parent !== window) {
                window.parent.postMessage({
                    type: 'settingsUpdate',
                    data: { calculationMode: mode }
                }, '*');
            }
        }

        // Update labor rates based on customer type (contract vs non-contract)
        function updateLaborRates() {
            const customerType = document.getElementById('customerType').value;
            const laborRateField = document.getElementById('laborRate');
            const overtimeRateField = document.getElementById('overtimeRate');
            const doubleTimeRateField = document.getElementById('doubleTimeRate');
            
            if (customerType === 'contract') {
                // Contract rates (5% discount)
                laborRateField.value = '182.00';
                overtimeRateField.value = '255.50';
                doubleTimeRateField.value = '382.00';
            } else {
                // Non-contract rates (standard)
                laborRateField.value = '191.00';
                overtimeRateField.value = '255.50';
                doubleTimeRateField.value = '382.00';
            }
            
            // Recalculate all service totals with new rates
            recalculateTotals();
        }

        // Initialize
        recalculateTotals();

        // ===== NEW LABOR & TRAVEL TAB HANDLERS =====
        
        // Update rate mode (Private/Public Works/Government)
        function updateRateMode() {
            const mode = document.getElementById('rateMode').value;
            const description = document.getElementById('rateModeDescription');
            const standardSection = document.getElementById('standardRatesSection');
            const prevailingSection = document.getElementById('prevailingWageSection');
            const summary = document.getElementById('rateSummary');
            
            // Show/hide sections based on mode
            if (mode === 'private') {
                standardSection.style.display = 'block';
                prevailingSection.style.display = 'none';
                
                description.innerHTML = `
                    <strong style="color: var(--accent-electric);">Private Sector Mode</strong><br>
                    Using Energen standard labor rates for commercial customers.<br>
                    ‚Ä¢ Base Rate: $180.00/hr<br>
                    ‚Ä¢ No prevailing wage requirements<br>
                    ‚Ä¢ Standard markups apply
                `;
                
                const baseRate = parseFloat(document.getElementById('laborRate').value);
                summary.innerHTML = `
                    <strong>Mode:</strong> Private Sector<br>
                    <strong>Base Rate:</strong> $${baseRate.toFixed(2)}/hr<br>
                    <strong>Overtime:</strong> $${(baseRate * 1.5).toFixed(2)}/hr (1.5√ó)<br>
                    <strong>Double Time:</strong> $${(baseRate * 2.0).toFixed(2)}/hr (2.0√ó)<br>
                    <strong>Per Diem:</strong> Not applicable
                `;
                
            } else if (mode === 'public-works') {
                standardSection.style.display = 'none';
                prevailingSection.style.display = 'block';
                
                description.innerHTML = `
                    <strong style="color: var(--accent-gold);">Public Works Mode</strong><br>
                    Using California prevailing wage rates per DIR requirements.<br>
                    ‚Ä¢ Operating Engineers Group 8 (Stationary Power Plant)<br>
                    ‚Ä¢ Zone-based adjustments apply<br>
                    ‚Ä¢ Fringe benefits included ($32/hr)<br>
                    ‚Ä¢ Per diem rates apply
                `;
                
                updateOERate(); // Calculate current OE rates
                updatePerDiemRates(); // Update per diem
                
            } else if (mode === 'government') {
                standardSection.style.display = 'block';
                prevailingSection.style.display = 'none';
                
                description.innerHTML = `
                    <strong style="color: var(--accent-green);">Government Contract Mode</strong><br>
                    Using GSA Schedule rates for federal contracts.<br>
                    ‚Ä¢ Negotiated federal rates<br>
                    ‚Ä¢ Per diem applies<br>
                    ‚Ä¢ No zone adjustments
                `;
                
                const baseRate = parseFloat(document.getElementById('laborRate').value);
                const perDiem = parseFloat(document.getElementById('perDiemTotal').value);
                summary.innerHTML = `
                    <strong>Mode:</strong> Government Contract<br>
                    <strong>Base Rate:</strong> $${baseRate.toFixed(2)}/hr<br>
                    <strong>Overtime:</strong> $${(baseRate * 1.5).toFixed(2)}/hr (1.5√ó)<br>
                    <strong>Double Time:</strong> $${(baseRate * 2.0).toFixed(2)}/hr (2.0√ó)<br>
                    <strong>Per Diem:</strong> $${perDiem.toFixed(2)}/day
                `;
            }
            
            // Store mode preference
            localStorage.setItem('laborRateMode', mode);
        }
        
        // Update overtime rates when base rate changes
        function updateOvertimeRates() {
            const laborRateElement = document.getElementById('laborRate');
            if (!laborRateElement) {
                console.warn('updateOvertimeRates: laborRate element not found');
                return;
            }

            const baseRate = parseFloat(laborRateElement.value) || 0;

            const overtimeElement = document.getElementById('overtimeRate');
            const doubleTimeElement = document.getElementById('doubleTimeRate');
            const mobilizationRateElement = document.getElementById('mobilizationRate');

            if (overtimeElement) {
                overtimeElement.value = (baseRate * 1.5).toFixed(2);
            }
            if (doubleTimeElement) {
                doubleTimeElement.value = (baseRate * 2.0).toFixed(2);
            }
            
            // Update mobilization rate to match labor rate by default
            if (mobilizationRateElement) {
                // Only update if user hasn't manually changed it (check if it's still the default)
                const currentMobilization = parseFloat(mobilizationRateElement.value) || 0;
                if (Math.abs(currentMobilization - 180.00) < 0.01 || Math.abs(currentMobilization - baseRate) < 0.01) {
                    mobilizationRateElement.value = baseRate.toFixed(2);
                }
            }

            // Update summary if in private mode
            const rateModeElement = document.getElementById('rateMode');
            if (rateModeElement && rateModeElement.value === 'private') {
                updateRateMode();
            }
        }
        
        // Update Operating Engineers rates based on classification and zone
        function updateOERate() {
            const classification = document.getElementById('oeClassification').value;
            const zoneMultiplier = parseFloat(document.getElementById('zoneMultiplier').value);
            
            // Base rates (from prevailing-wage-service.cjs)
            const baseRates = {
                'group1': 72.00,
                'group3': 85.50,
                'group8': 92.00,  // Correct for stationary engineers
                'foreman': 100.00
            };
            
            const baseRate = baseRates[classification] || 92.00;
            const adjustedRate = baseRate * zoneMultiplier;
            const fringeTotal = 32.00; // Total fringe benefits
            const totalRate = adjustedRate + fringeTotal;
            
            // Update display fields
            document.getElementById('oeGroup8Rate').value = baseRate.toFixed(2);
            document.getElementById('oeAdjustedRate').value = adjustedRate.toFixed(2);
            document.getElementById('oeTotalRate').value = totalRate.toFixed(2);
            document.getElementById('oeOvertimeRate').value = (adjustedRate * 1.5 + fringeTotal).toFixed(2);
            document.getElementById('oeDoubleTimeRate').value = (adjustedRate * 2.0 + fringeTotal).toFixed(2);
            
            // Update summary
            const summary = document.getElementById('rateSummary');
            const perDiem = parseFloat(document.getElementById('perDiemTotal').value);
            
            summary.innerHTML = `
                <strong>Mode:</strong> Public Works<br>
                <strong>Classification:</strong> OE ${classification === 'group8' ? 'Group 8 (Stationary)' : classification}<br>
                <strong>Base Rate:</strong> $${adjustedRate.toFixed(2)}/hr<br>
                <strong>With Fringe:</strong> $${totalRate.toFixed(2)}/hr<br>
                <strong>Overtime:</strong> $${(adjustedRate * 1.5 + fringeTotal).toFixed(2)}/hr<br>
                <strong>Double Time:</strong> $${(adjustedRate * 2.0 + fringeTotal).toFixed(2)}/hr<br>
                <strong>Per Diem:</strong> $${perDiem.toFixed(2)}/day
            `;
        }
        
        // Update per diem rates based on location
        function updatePerDiemRates() {
            const location = document.getElementById('perDiemLocation').value;
            
            // GSA per diem rates for California (2024)
            const rates = {
                'sf': { lodging: 304, meals: 79, total: 383 },
                'la': { lodging: 195, meals: 74, total: 269 },
                'sd': { lodging: 181, meals: 74, total: 255 },
                'sac': { lodging: 134, meals: 64, total: 198 },
                'standard': { lodging: 107, meals: 59, total: 166 }
            };
            
            if (location !== 'custom' && rates[location]) {
                const rate = rates[location];
                document.getElementById('perDiemLodging').value = rate.lodging;
                document.getElementById('perDiemMeals').value = rate.meals;
                document.getElementById('perDiemTotal').value = rate.total;
                
                // Make fields readonly for preset locations
                document.getElementById('perDiemLodging').readOnly = true;
                document.getElementById('perDiemMeals').readOnly = true;
            } else if (location === 'custom') {
                // Enable manual entry
                document.getElementById('perDiemLodging').readOnly = false;
                document.getElementById('perDiemMeals').readOnly = false;
                
                // Calculate total
                const lodging = parseFloat(document.getElementById('perDiemLodging').value) || 0;
                const meals = parseFloat(document.getElementById('perDiemMeals').value) || 0;
                document.getElementById('perDiemTotal').value = (lodging + meals).toFixed(0);
            }
            
            // Update summary if in public works mode
            const mode = document.getElementById('rateMode').value;
            if (mode === 'public-works') {
                updateOERate();
            }
        }

        /**
         * Fetch prevailing wage data from DIR API based on ZIP code
         * Populates read-only fields in settings modal
         */
        async function refreshPrevailingWage() {
            // Get ZIP from main UI or settings modal
            const zip = document.getElementById('zip')?.value ||
                        document.getElementById('pwZipCode')?.value;

            if (!zip || zip.length < 5) {
                alert('Please enter a valid 5-digit ZIP code first');
                return;
            }

            try {
                // Show loading state
                const button = event.target;
                const originalText = button.innerHTML;
                button.innerHTML = '‚è≥ Fetching...';
                button.disabled = true;

                const response = await fetch(`/api/prevailing-wage/${zip}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: Failed to fetch prevailing wage data`);
                }

                const data = await response.json();

                // Populate API fields
                document.getElementById('pwZipCode').value = zip;
                document.getElementById('pwCounty').value = data.location.county || 'Unknown';
                document.getElementById('pwClassification').value = data.location.craft || 'Electrician Inside Wireman';
                document.getElementById('pwApiRate').value = data.prevailingWage.electricianJourneyman.toFixed(2);
                document.getElementById('pwLastUpdated').textContent = new Date().toLocaleString();

                // Trigger recalculation
                calculatePrevailingWageTotal();

                // Restore button
                button.innerHTML = originalText;
                button.disabled = false;

            } catch (error) {
                console.error('Error fetching prevailing wage:', error);
                alert(`Could not fetch prevailing wage data: ${error.message}\n\nPlease check ZIP code and try again.`);

                // Restore button
                if (event.target) {
                    event.target.innerHTML = 'üîÑ Refresh from DIR API';
                    event.target.disabled = false;
                }
            }
        }

        /**
         * Calculate total labor rate = API wage + business overhead
         * Auto-updates final rate unless manually overridden
         */
        function calculatePrevailingWageTotal() {
            const apiRate = parseFloat(document.getElementById('pwApiRate').value) || 0;
            const overhead = parseFloat(document.getElementById('businessOverhead').value) || 0;
            const calculated = apiRate + overhead;

            // Update calculated rate (read-only)
            document.getElementById('pwCalculatedRate').value = calculated.toFixed(2);

            // Update final rate (editable) - only if not manually overridden
            const finalRateField = document.getElementById('pwFinalRate');
            if (!finalRateField.dataset.manualOverride) {
                finalRateField.value = calculated.toFixed(2);
            }

            // Update the breakdown text
            const breakdownText = `= $${apiRate.toFixed(2)} (wage) + $${overhead.toFixed(2)} (overhead)`;
            document.getElementById('pwCalculatedBreakdown').textContent = breakdownText;

            console.log('Prevailing wage calculation:', {
                apiRate: apiRate,
                overhead: overhead,
                calculated: calculated,
                manualOverride: finalRateField.dataset.manualOverride || 'false'
            });
        }
        
        // Listen for per diem manual changes
        document.getElementById('perDiemLodging')?.addEventListener('input', function() {
            if (document.getElementById('perDiemLocation').value === 'custom') {
                const lodging = parseFloat(this.value) || 0;
                const meals = parseFloat(document.getElementById('perDiemMeals').value) || 0;
                document.getElementById('perDiemTotal').value = (lodging + meals).toFixed(0);
            }
        });
        
        document.getElementById('perDiemMeals')?.addEventListener('input', function() {
            if (document.getElementById('perDiemLocation').value === 'custom') {
                const lodging = parseFloat(document.getElementById('perDiemLodging').value) || 0;
                const meals = parseFloat(this.value) || 0;
                document.getElementById('perDiemTotal').value = (lodging + meals).toFixed(0);
            }
        });
        
        // Initialize the new Labor & Travel tab
        updateRateMode();
        updateOvertimeRates();
    </script>
</body>
</html>